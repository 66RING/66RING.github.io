<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Mens et Manus">
<meta property="og:type" content="website">
<meta property="og:title" content="Ring&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Ring&#39;s Blog">
<meta property="og:description" content="Mens et Manus">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Travis TuRing">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Ring's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ring's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/20/Major/OS/Computer_System_A_Programmer's_Perspective/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Travis TuRing">
      <meta itemprop="description" content="Mens et Manus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ring's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/20/Major/OS/Computer_System_A_Programmer's_Perspective/" class="post-title-link" itemprop="url">深入理解计算机系统脑图</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-20 00:00:00" itemprop="dateCreated datePublished" datetime="2020-10-20T00:00:00+08:00">2020-10-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-25 22:49:42" itemprop="dateModified" datetime="2020-10-25T22:49:42+08:00">2020-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="PART1-计算机系统漫游"><a href="#PART1-计算机系统漫游" class="headerlink" title="PART1: 计算机系统漫游"></a>PART1: 计算机系统漫游</h2><ul>
<li>组成设备</li>
</ul>
<h2 id="PART3-程序的机器级表示"><a href="#PART3-程序的机器级表示" class="headerlink" title="PART3: 程序的机器级表示"></a>PART3: 程序的机器级表示</h2><ul>
<li>一个可执行程序<ul>
<li>编译过程<ul>
<li>预处理</li>
<li>编译</li>
<li>汇编</li>
<li>连接</li>
</ul>
</li>
<li>编译细节<ul>
<li><code>gcc -O[g|1|2] &lt;file&gt;</code>优化等级</li>
<li>编译器优化可能会调整代码次序，源代码会严重变形，导致并发时不满足顺序一致性内存模型</li>
</ul>
</li>
</ul>
</li>
<li>数据格式<ul>
<li>字节，字，双字，四字</li>
<li>数据类型的汇编代码表示<ul>
<li>b, w, l, q </li>
</ul>
</li>
</ul>
</li>
<li>操作数指示符<ul>
<li>操作数可以是立即数值、寄存器值和来自内存的值</li>
<li>立即数的形式<code>$Imm</code></li>
<li>寄存器的形式<code>%r</code></li>
<li>内存寻址的形式<code>Imm(rb, ri, si)</code><ul>
<li>表示<code>M[Imm + R[rb] + R[ri]*si</code>，参数是可以省略的，如<code>(,%rcx,)</code></li>
<li><code>M[]</code>表示取内存值，<code>R[]</code>表示取寄存器值</li>
</ul>
</li>
</ul>
</li>
<li>数据传送指令<ul>
<li><code>mov[数据大小]</code></li>
</ul>
</li>
<li>几类寄存器的格式<ul>
<li><code>r[a|b|c|d]x</code>、<code>eax</code>、<code>ax</code>、<code>al</code></li>
<li><code>r[s|d]i</code>、<code>esi</code>、<code>si</code>、<code>sil</code></li>
<li><code>r[b|s]p</code>、<code>esp</code>、<code>sp</code>、<code>spl</code></li>
<li><code>r[8-9]</code>、<code>r8d</code>、<code>r8w</code>、<code>r8b</code></li>
<li>简记：有r说明4字、e说明双字、l说明字节，剩下的就说明是单字</li>
</ul>
</li>
<li>lea(load effective address)取有效地址<ul>
<li><code>leaq 7(%rdi, %rsi, 4), %rax</code>，则<code>%rad=7+R[%rdi]+R[%rsi]*4</code></li>
<li>处理用在取地址，还可以用在简单的加法和乘法</li>
</ul>
</li>
</ul>
<h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">低地址：</span><br><span class="line">    栈顶：%rsp-&gt; |   |</span><br><span class="line">                |   |</span><br><span class="line">                .....</span><br><span class="line">    栈底        |   |</span><br><span class="line">高地址</span><br></pre></td></tr></table></figure>

<ul>
<li><code>pushq S</code>(4字)<ul>
<li><code>R[%rsp] &lt;- R[%rsp]-8</code>，栈顶指针减8<ul>
<li>相当于<code>subq $8, %rsp</code></li>
</ul>
</li>
<li><code>M[R[%rsp]] &lt;- S</code>，入栈<ul>
<li>相当于<code>movq %rbp, (%rsp)</code></li>
</ul>
</li>
<li>区别在于<code>pushq</code>指令编码为1字节</li>
</ul>
</li>
<li>弹出同理<ul>
<li>出栈</li>
<li>指针加</li>
</ul>
</li>
<li>知道了栈内存的分布，则可用内存寻址访问栈<ul>
<li><code>movq 8(%rsp), %rdx</code>，把栈第二个元素存到rdx寄存器中</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/06/universe/lua/lua_stl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Travis TuRing">
      <meta itemprop="description" content="Mens et Manus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ring's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/06/universe/lua/lua_stl/" class="post-title-link" itemprop="url">Lua标准库工具</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-10-06 00:00:00 / Modified: 20:11:53" itemprop="dateCreated datePublished" datetime="2020-10-06T00:00:00+08:00">2020-10-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="string"><a href="#string" class="headerlink" title="string"></a>string</h2><ul>
<li><code>string.gmatch(s, pattern)</code><ul>
<li>返回一个迭代器函数，每次调用这个函数，返回一个在字符串<code>s</code>找到的下一个pattern描述的子串。没找到返回<code>nil</code></li>
<li>类型类似正则表达式(或者就是)<ul>
<li><code>%a</code>查找一个字母</li>
<li><code>%w</code>查找一个数字或字母</li>
<li><code>%d</code>查找一个数字</li>
<li><code>(%w+)=(%w+)</code>，<code>()</code>分组，返回成对的，<code>+</code>找一个及以上</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="table"><a href="#table" class="headerlink" title="table"></a>table</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/05/universe/database/sql_base_usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Travis TuRing">
      <meta itemprop="description" content="Mens et Manus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ring's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/05/universe/database/sql_base_usage/" class="post-title-link" itemprop="url">SQL基本语句</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-05 00:00:00" itemprop="dateCreated datePublished" datetime="2020-10-05T00:00:00+08:00">2020-10-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-06 19:25:38" itemprop="dateModified" datetime="2020-10-06T19:25:38+08:00">2020-10-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tbl_file`</span>(</span><br><span class="line">    <span class="string">`id`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span>(<span class="string">`id`</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx_user_file`</span> (<span class="string">`user_name`</span>, <span class="string">`file_sha1`</span>),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`idx_status`</span> (<span class="string">`status`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>PRIMARY KEY(&lt;name&gt;)</code></li>
<li><code>UNIQUE KEY &lt;name&gt; (&lt;name1...&gt;)</code>表示name1…中所有字段是唯一的，命名为name<ul>
<li><code>INSERT IGNORE</code>时，要插入与unique相同的自动将会跳过</li>
</ul>
</li>
<li><code>KEY &lt;name&gt; (&lt;name&gt;)</code></li>
</ul>
<h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><p><code>INSERT [INGORE] INTO &lt;表名&gt; &lt;字段名...&gt; VALUES &lt;字段对应值&gt;</code></p>
<ul>
<li><code>IGNORE</code>表示如果要插入的字段已存在，则忽略(不执行插入)</li>
</ul>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><ul>
<li>软删除<code>DELETE</code></li>
<li>硬删除<code>DROP</code></li>
</ul>
<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><h4 id="UPDATE语句"><a href="#UPDATE语句" class="headerlink" title="UPDATE语句"></a>UPDATE语句</h4><p><code>UPDATE &lt;table_name&gt; SET &lt;column&gt;=&lt;value&gt;... WHERE &lt;column&gt;=&lt;value&gt;</code></p>
<p> <strong>注意WHERE限定范围</strong> ，否则所有记录都将被更新</p>
<h4 id="REPALCE函数"><a href="#REPALCE函数" class="headerlink" title="REPALCE函数"></a>REPALCE函数</h4><ul>
<li>插入替换<ul>
<li>似乎如果碰到unique key就会替换</li>
<li><code>REPLACE INTO &lt;表名&gt; (&lt;字段...&gt;) VALUES &lt;新字段,...&gt;</code></li>
</ul>
</li>
<li>replace()函数<ul>
<li><code>REPALCE(&lt;object&gt;, &lt;search&gt;, &lt;replace&gt;)</code></li>
<li>将内容<code>&lt;object&gt;</code>中<code>&lt;search&gt;</code>到的替换为<code>&lt;repalce&gt;</code></li>
<li>实例<ul>
<li><code>SELECT REPLACE(&#39;http://&#39;,&#39;http&#39;,&#39;https&#39;)</code></li>
<li><code>UPDATE &lt;table_name&gt; SET name=replace(name,&#39;a&#39;,&#39;b&#39;)</code><ul>
<li>将表中name字段中所有a替换成b</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p><code>SELECT &lt;字段...&gt; FROM [数据库].&lt;表&gt; [WHERE statement] [LIMIT statement]</code></p>
<h3 id="修改删除字段"><a href="#修改删除字段" class="headerlink" title="修改删除字段"></a>修改删除字段</h3><p><code>ALTER TABLE &lt;表名&gt; &lt;操作...&gt;</code>，如：</p>
<ul>
<li>新增, <code>ALTER TABLE &lt;表名&gt; ADD COlUMN &lt;字段名&gt; [定义...]</code></li>
<li>删除字段，<code>ALTER TABLE &lt;表名&gt; DROP &lt;字段名&gt;</code>，如：  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tbl_user_file DROP INDEX &#96;idx_user_file&#96;;</span><br></pre></td></tr></table></figure></li>
<li>修改字段，<code>ALTER TABLE &lt;表名&gt; CHANGE &lt;旧字段名&gt; &lt;新字段名&gt; &lt;新数据类型&gt;;</code>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_emp1 <span class="keyword">CHANGE</span> col1 col3 <span class="built_in">CHAR</span>(<span class="number">30</span>);</span><br></pre></td></tr></table></figure></li>
<li>修改字段类型，<code>ALTER TABLE &lt;表名&gt; MODIFY &lt;字段名&gt; &lt;数据类型&gt;</code></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/03/universe/web/promise_async_and_wait/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Travis TuRing">
      <meta itemprop="description" content="Mens et Manus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ring's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/03/universe/web/promise_async_and_wait/" class="post-title-link" itemprop="url">Promise, async和wait的简单记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-10-03 00:00:00 / Modified: 18:08:25" itemprop="dateCreated datePublished" datetime="2020-10-03T00:00:00+08:00">2020-10-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="为什么需要promise"><a href="#为什么需要promise" class="headerlink" title="为什么需要promise"></a>为什么需要promise</h2><p>有时候需要向函数中传入回调函数(异步操作结束后执行)，这么一来可能就会有多重函数嵌套的情况。这样的问题很明显：</p>
<ul>
<li>耦合度高</li>
<li>解耦要传函数指针<ul>
<li>安全考虑还需判断参数类型，可读性差</li>
<li>如果传送匿名参数，可读性更差</li>
</ul>
</li>
</ul>
<h2 id="Promise写法"><a href="#Promise写法" class="headerlink" title="Promise写法"></a>Promise写法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callRing</span>(<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"calling Ring ..."</span>)</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (success) &#123;</span><br><span class="line">                resolve()</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                reject()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">3000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">callRing(<span class="literal">true</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;) <span class="comment">// promise对象上的then方法。传入resolve函数</span></span><br><span class="line">    .catch(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;) <span class="comment">// promise对象上的catch方法。传入reject函数</span></span><br><span class="line">    <span class="comment">// 由于返回了promise对象，所以多次then调用是可行的</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>.then(function)</code>，传入promise对象的参数resolve和reject<ul>
<li>当然，可以传入两个参数，即第二个参数就是reject。用来指定reject回调</li>
</ul>
</li>
<li><code>.catch(function)</code><ul>
<li>它就是then的第二个参数</li>
<li>这么写能够处理执行resolve遇到异常的情况<ul>
<li>如果resolve执行时遇到异常，将会条到<code>.catch</code>中</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Promise还有很多用法：all，race等</strong></p>
<h3 id="async、await"><a href="#async、await" class="headerlink" title="async、await"></a>async、await</h3><p>如果不喜欢.then这样的写法，可以使用async、await的写法</p>
<p>async的本质就是promise的语法糖，标记了async的function里面可以执行await的同步方法，await后的代码要等待await执行完成。</p>
<p>[猜]为什么promise能够做到同步呢？即.then().then()的同步原理</p>
<ul>
<li>当执行第一个promise时，是异步操作，最后才能返回promise。所以如果promise没返回就不会执行下一个</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// callRing函数不变</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 有await这个关键词的代码只能在一个async 定义的函数里执行</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">await</span> callRing(<span class="literal">true</span>) <span class="comment">// 如果是resolve则执行后续的代码</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"resolve"</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e)&#123;</span><br><span class="line">        <span class="comment">// 如果reject则执行catch的代码</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"resolve"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">action()</span><br></pre></td></tr></table></figure>

<p>或使用IIFE的写法，定义成匿名函数然后立即执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// callRing函数不变</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">await</span> callRing(<span class="literal">true</span>) <span class="comment">// 如果是resolve则执行后续的代码</span></span><br><span class="line">        <span class="comment">// 否则抛出异常</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"resolve"</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e)&#123;</span><br><span class="line">        <span class="comment">// 如果reject则执行catch的代码</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"resolve"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/01/universe/docker_base_usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Travis TuRing">
      <meta itemprop="description" content="Mens et Manus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ring's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/01/universe/docker_base_usage/" class="post-title-link" itemprop="url">Docker常用命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-01 00:00:00" itemprop="dateCreated datePublished" datetime="2020-10-01T00:00:00+08:00">2020-10-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-23 21:09:52" itemprop="dateModified" datetime="2020-10-23T21:09:52+08:00">2020-10-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h2><ul>
<li><code>docker ps [-a]</code>，查看正在运行的[所有]容器</li>
<li><code>docker &lt;start|stop|rm&gt; &lt;ID|NAME&gt;</code>，启动/停止/删除容器<ul>
<li><code>docker rmi &lt;IMAGES&gt;</code>，删除镜像</li>
</ul>
</li>
<li><code>docker attach id</code>，进入某个容器，使用exit退出容器时，容器也会停止</li>
<li><code>docker exec -it &lt;ID|NAME&gt; &lt;/bin/bash&gt;</code>，启动一个shell，以交互形式进入容器，exit时容器不停止</li>
<li><code>docker run --name NEWNAME -it CONTAINER [/bin/bash]</code><ul>
<li>复制CONTAINER容器，并重命名为NEWNAME，[使用bash以交互模式进入]</li>
</ul>
</li>
</ul>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="配置容器"><a href="#配置容器" class="headerlink" title="配置容器"></a>配置容器</h3><ul>
<li><ol>
<li>交互式编辑<ul>
<li><code>docker run -it &lt;ID|NAME&gt; &lt;/bin/bash&gt;</code>，交互式进入，安装编辑器编辑对应的配置文件<ul>
<li>见<code>man docker &lt;COMMAND&gt;</code></li>
<li><code>-i</code>表示启动一个可以交互的容器</li>
<li><code>-t</code>表示分配一个pseudo-tty</li>
<li><code>-d</code>(detach)表示后台启动</li>
</ul>
</li>
<li>在一个TCP端口上绑定一个服务<ul>
<li><code>-p ip:[hostPort]:containerPort | [hostPort:]containerPort</code></li>
<li><code>-P</code>暴露容器所有端口到宿主机上的随机端口</li>
</ul>
</li>
<li>安装ssh服务后，使用ssh进入编辑<ul>
<li><ol>
<li><code>apt-get install openssh-server</code></li>
</ol>
</li>
<li><ol start="2">
<li>修改配置文件，”PermitRootLogin without-password”去掉注释免密登录</li>
</ol>
</li>
<li><ol start="3">
<li><code>service ssh start</code></li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li><ol start="2">
<li><code>docker cp &lt;CONTAINER:/path/to/conf&gt; &lt;/source/file&gt;</code></li>
</ol>
</li>
</ul>
<h3 id="管理容器数据"><a href="#管理容器数据" class="headerlink" title="管理容器数据"></a>管理容器数据</h3><ul>
<li>数据卷(volume)：<ul>
<li><code>-v[=[[HOST-DIR:]CONTAINER-DIR[:OPTIONS]]]</code></li>
<li>TODO</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/16/universe/vim/advanced_vim_programming/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Travis TuRing">
      <meta itemprop="description" content="Mens et Manus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ring's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/16/universe/vim/advanced_vim_programming/" class="post-title-link" itemprop="url">Advanced Vim Programming</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-16 00:00:00" itemprop="dateCreated datePublished" datetime="2020-09-16T00:00:00+08:00">2020-09-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-25 09:49:30" itemprop="dateModified" datetime="2020-10-25T09:49:30+08:00">2020-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="lt-SID-gt"><a href="#lt-SID-gt" class="headerlink" title="&lt;SID&gt;"></a>&lt;SID&gt;</h2><blockquote>
<p>The string <code>&lt;SID&gt;</code> can be used in a mapping or menu.</p>
<p>When executing the map command, Vim will replace <code>&lt;SID&gt;</code> with the special key code <code>&lt;SNR&gt;</code>, followed by a number that’s unique for the script, and an underscore.  Example: <code>:map &lt;SID&gt;Add</code> could define a mapping <code>&lt;SNR&gt;23\_Add</code>.</p>
</blockquote>
<p>When you map some thing to a <code>s:</code> function, which means you may call it may mapping outside of the script. Try the follow scirpts:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function! s:say()</span><br><span class="line">    echo expand(&quot;&lt;SID&gt;&quot;)</span><br><span class="line">    echo &quot;hello&quot;</span><br><span class="line">endfunction</span><br><span class="line">map WW :call s:say()&lt;CR&gt;</span><br><span class="line">map RR :call &lt;SID&gt;say()&lt;CR&gt;</span><br></pre></td></tr></table></figure>

<p>When mapping <code>WW</code> is executed from outside of scirpt, it don’t know which the script the function was defined.</p>
<p>The <code>:scriptnames</code> command can be used to see which scripts have been sourced</p>
<h3 id="lt-sfile-gt"><a href="#lt-sfile-gt" class="headerlink" title="&lt;sfile&gt;"></a>&lt;sfile&gt;</h3><p><code>:h &lt;sfile&gt;</code></p>
<h2 id="lt-Plug-gt"><a href="#lt-Plug-gt" class="headerlink" title="&lt;Plug&gt;"></a>&lt;Plug&gt;</h2><blockquote>
<p>The special key name <code>&lt;Plug&gt;</code> can be used for an internal mapping, which is not to be matched with any key sequence.  This is useful in plugins</p>
</blockquote>
<p>As the doc file said, <code>&lt;Plug&gt;</code> key is often use in a internal mapping. Like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func! s:somecme</span><br><span class="line">    ...</span><br><span class="line">endfunc</span><br><span class="line">noremap &lt;silent&gt; &lt;Plug&gt;SomeCmd :call &lt;SID&gt;somecmd</span><br><span class="line">nmap ss &lt;Plug&gt;SomeCmd</span><br></pre></td></tr></table></figure>

<ul>
<li>Why Vim has this feature?<ul>
<li>may be its a way to set alias in vimscript?</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/03/universe/RPC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Travis TuRing">
      <meta itemprop="description" content="Mens et Manus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ring's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/03/universe/RPC/" class="post-title-link" itemprop="url">RPC intro</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-03 00:00:00" itemprop="dateCreated datePublished" datetime="2020-09-03T00:00:00+08:00">2020-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-02 22:02:57" itemprop="dateModified" datetime="2020-10-02T22:02:57+08:00">2020-10-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="RPC-Remote-Procedure-Call"><a href="#RPC-Remote-Procedure-Call" class="headerlink" title="RPC (Remote Procedure Call)"></a>RPC (Remote Procedure Call)</h2><p>RPC，远程过程调用，是一个计算机通信协议。</p>
<p>相对的就是本地过程调用，即一个程序中调用它的子程序，可以直接通过地址访问。而RPC的远程，就是跨进程访问的意思。</p>
<p>该协议允许运行于一台计算机的程序调用另一个地址空间(通常是开放网络中的一台计算机)的子程序。程序员就像调用本地程序一样，无需额外地为这个交互作用编程。</p>
<p>RPC是一种Client/Server的进程间通信模式，程序分布在不同的地址空间里。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Client          Server</span><br><span class="line">    |               ^</span><br><span class="line">    v               |</span><br><span class="line">proxy           proxy       动态代理层</span><br><span class="line">    |               |</span><br><span class="line">protocol        protocol    序列化&#x2F;反序列化层</span><br><span class="line">    |               | </span><br><span class="line">network   ---&gt;  network     网络传输层</span><br></pre></td></tr></table></figure>



<h2 id="Go语言RPC实例"><a href="#Go语言RPC实例" class="headerlink" title="Go语言RPC实例"></a>Go语言RPC实例</h2><h3 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h3><p>GO语言的RPC包路径为<code>net/rpc</code></p>
<ul>
<li>一个对象要能走RPC调用需要规则<ul>
<li>Go语言的RPC规则：公开方法只能有两个可序列化的参数，第二个参数为指针类型，并返回一个error</li>
</ul>
</li>
<li>注册RPC服务<code>rpc.RegisterName(&quot;NameSpace&quot;, new(对象))</code><ul>
<li>会将对象类型中所有满足RPC规则的对象方法注册为RPC函数</li>
<li>所有注册的方法会放在”NameSpace”的命名空间下</li>
</ul>
</li>
<li>拨号RPC服务<code>client, err := rpc.Dial(&quot;tcp&quot;, &quot;localhost:1234&quot;)</code><ul>
<li>这里建立通过tcp调用本机1234端口的rpc服务的连接</li>
</ul>
</li>
<li>调用RPC服务<code>client.Call(&quot;NameSpace.Func&quot;, &quot;arg1&quot;, &amp;args)</code><ul>
<li>第一个参数用点连接RPC服务的名字和要调用的方法</li>
<li>第二、三个参数，是RPC需要的两个参数</li>
</ul>
</li>
<li><strong>安全的RPC调用</strong> <ul>
<li>上面就实现的简单的RPC调用过程，但是在<strong>RPC方法名，参数类型等还存在安全隐患</strong>。所以更安全的RPC调用需要进行一些简单的封装<ul>
<li>如：  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *RPCServerClien)</span> <span class="title">SomeFunc</span><span class="params">(request <span class="keyword">string</span>, reply *<span class="keyword">string</span>)</span> <span class="title">error</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> p.Client.Call(<span class="string">"NameSpace.SomeFunc"</span>, request, reply)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/20/universe/js_ts/this_and_arrow_function/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Travis TuRing">
      <meta itemprop="description" content="Mens et Manus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ring's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/20/universe/js_ts/this_and_arrow_function/" class="post-title-link" itemprop="url">This和箭头函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-20 00:00:00 / Modified: 16:24:00" itemprop="dateCreated datePublished" datetime="2020-08-20T00:00:00+08:00">2020-08-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="This"><a href="#This" class="headerlink" title="This"></a>This</h2><p><strong>This用于访问当前方法所属的对象</strong>，取决于调用的对象如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    a: <span class="number">12</span>,</span><br><span class="line">    fn()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 或者形如</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    a: <span class="number">12</span>,</span><br><span class="line">&#125;</span><br><span class="line">obj.fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj.fn()  <span class="comment">// 将打印obj这个对象</span></span><br></pre></td></tr></table></figure>

<p>上面的例子中，<code>fn()</code>输入obj，所以this就是obj</p>
<h3 id="调用工具函数来改变this"><a href="#调用工具函数来改变this" class="headerlink" title="调用工具函数来改变this"></a>调用工具函数来改变this</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>当直接调用<code>show()</code>时，严格模式下this是undefine</li>
<li>使用<code>call</code>强制改变<code>this</code><ul>
<li><code>show.call(obj)</code>，那么this就等于obj</li>
<li>与call类似的还有<code>bind</code>，<code>apply</code>等<ul>
<li><code>f=show.bind(obj)</code>指定this为obj并返回一个函数</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h2><p>普通函数中，this取决于调用;在箭头函数中，this取决于定义。定义箭头函数时，箭头函数中的this取决于当前环境的this，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>)  <span class="comment">// &#123;&#125;</span></span><br><span class="line"><span class="keyword">const</span> fn=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line">fn()  <span class="comment">// &#123;&#125;</span></span><br><span class="line"><span class="comment">// 甚至call也改变不了</span></span><br><span class="line">fn.call(<span class="number">12</span>)  <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure>


<h3 id="应用举例"><a href="#应用举例" class="headerlink" title="应用举例"></a>应用举例</h3><p>如在react中想要点击按钮给数字加1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; WRONG</span><br><span class="line">&lt;button onClick&#x3D;&#123;function()&#123;</span><br><span class="line">    this.setState(&#123;a: this.state.a+1&#125;)</span><br><span class="line">&#125;&#125;&gt;按钮&lt;&#x2F;button&gt;</span><br><span class="line">&#x2F;&#x2F; WRONG 此时传入普通函数相当于直接调用，那么this就是undefine</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; CORRECT</span><br><span class="line">&lt;button onClick&#x3D;&#123;()&#x3D;&gt;&#123;</span><br><span class="line">    this.setState(&#123;a: this.state.a+1&#125;)</span><br><span class="line">&#125;&#125;&gt;按钮&lt;&#x2F;button&gt;</span><br><span class="line">&#x2F;&#x2F; CORRECT 此时传入箭头函数，this取决于当前环境，即React.Component这个class中</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/universe/go/golang_mem_alignment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Travis TuRing">
      <meta itemprop="description" content="Mens et Manus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ring's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/universe/go/golang_mem_alignment/" class="post-title-link" itemprop="url">Golang内存对齐</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-17 00:00:00 / Modified: 13:58:15" itemprop="dateCreated datePublished" datetime="2020-08-17T00:00:00+08:00">2020-08-17</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Golang内存对齐"><a href="#Golang内存对齐" class="headerlink" title="Golang内存对齐"></a><center>Golang内存对齐<center></h2><p>Cpu要想读取数据，需要通过 <strong>地址总线</strong> 把地址传输给内存。内存准备好数据输出到 <strong>数据总线</strong> ，交给CPU。</p>
<p>每根地址总线能表示一位，8根地址总线就能表示8位二进制数，即256个地址。因为表示不了更大的地址，所以就用不了更大的内存。</p>
<p>每次操作一字节太慢，那就加宽数据总线，要想一次操作一字节就至少需要32位数据总线。8字节就64位。这里每次操作的字节数就是所谓的  <strong>机器字长</strong> 。</p>
<p>从内存读取数据时通过”并行”操作同时从储存单元(DRAM芯片)读出数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">----+-------+-------+-------+---- address</span><br><span class="line">    |       |       |       |</span><br><span class="line">    |       |       |       |</span><br><span class="line">  chip1    chip2   chip3    chip4</span><br><span class="line">    |       |       |       |</span><br><span class="line">    0       0       1       1</span><br><span class="line">----</span><br><span class="line">0011...</span><br><span class="line">假设有8个chip</span><br></pre></td></tr></table></figure>

<p>每个储存单元共用同一个地址，各自从地址取出一位组成我们逻辑上认为的连续4字节数据。提高了内存访问效率。</p>
<p>采用着用设计，那么<code>address</code>就必须的8的倍数。如果非要错开一个格，那么错开后多出来的格子和其他不同，不能在一次操作中被同一个地址选中，所以这样的地址是不能用的。</p>
<p>CPU对这种情况的处理：多次读取。如取第一次读取的后7字节和第二次读取的前1字节拼接得到想要的8字节数据。但这样就影响了性能。</p>
<p>为了保证程序顺利高效的运行，编译器会把各种类型的数据安排到合适的地址并占用合适的长度，这就叫做 <strong>内存对齐</strong>。每种类型对齐值就是它的 <strong>对齐边界</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |</span><br><span class="line">|---|---|---|---|---|---|---|---|</span><br><span class="line">用0~1存储int16的数据，对齐值(对齐边界)就是2</span><br><span class="line">用4~7存储int32的数据，对齐边界就是4</span><br></pre></td></tr></table></figure>

<p>内存对齐要求数据存储地址以及占用的字节数都是它对齐边界的倍数。因此，在上面的情况中，如果int16从0开始(0%2=0;2%2=0)，那么int32就要错开两字节，从4开始(4%4=0;4%4=0)。</p>
<h3 id="如何确定每种类型的对齐边界"><a href="#如何确定每种类型的对齐边界" class="headerlink" title="如何确定每种类型的对齐边界"></a>如何确定每种类型的对齐边界</h3><p>这与平台有关，go支持很多平台386、arm、mips等。常见的32位平台指针宽度和寄存器宽度都是4字节，64位平台上都是8字节。被Go语言称为寄存器宽度的这个值就可以理解为机器字长，也是平台对应的最大对齐边界。</p>
<p>数据对齐边界取数据类型大小和平台最大对齐边界中较小的一个。如果只根据平台最大对齐边界对齐，则容易浪费很多字节(跳过很多空闲的字节)。</p>
<h3 id="结构体的对齐边界"><a href="#结构体的对齐边界" class="headerlink" title="结构体的对齐边界"></a>结构体的对齐边界</h3><p>取结构体中数据类型大小最大的成员，这个就是这个结构体的对齐边界。</p>
<ul>
<li><ol>
<li>存储这个结构体的起始地址是对齐边界的倍数</li>
</ol>
</li>
<li><ol start="2">
<li>结构体每个成员存储时，都把起始地址当作地址0，然后再用相对地址决定自己放在哪</li>
</ol>
</li>
<li><ol start="3">
<li>结构体整体占用字节数需要是类型对齐边界的倍数，不够的话往后扩张</li>
</ol>
</li>
</ul>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">type T struct&#123;</span><br><span class="line">    a int8   &#x2F;&#x2F; 1byte</span><br><span class="line">    b int64  &#x2F;&#x2F; 8byte</span><br><span class="line">    c int32  &#x2F;&#x2F; 4byte</span><br><span class="line">    d int16  &#x2F;&#x2F; 2byte</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">最大是8，所以改结构体对齐边界是8</span><br><span class="line"></span><br><span class="line">第一个成员a从0开始;第二个成员要对齐，只能从8开始;第三个成员从16开始，占用16~19;第四个成员从20开始占用20~21。然后还需要向后扩张到23</span><br></pre></td></tr></table></figure>

<p>思考：调整结构体成员的顺序是否能够优化内存？</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/11/universe/go/gui_programming/gui_programming/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Travis TuRing">
      <meta itemprop="description" content="Mens et Manus">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ring's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/11/universe/go/gui_programming/gui_programming/" class="post-title-link" itemprop="url">Golang gui 编程笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-08-11 00:00:00" itemprop="dateCreated datePublished" datetime="2020-08-11T00:00:00+08:00">2020-08-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-12 20:49:00" itemprop="dateModified" datetime="2020-08-12T20:49:00+08:00">2020-08-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h2><ul>
<li>初始化</li>
<li>用户设置<ul>
<li><ol>
<li>创建主窗口<ul>
<li><code>win := gtk.NewWindow(gtk.WINDOW_TOPLEVEL)</code></li>
</ul>
</li>
</ol>
</li>
<li><ol start="2">
<li>设置窗口属性<ul>
<li><code>win.SetTitle(&quot;gtk go&quot;)</code></li>
<li><code>win.SetSizeRequest(400, 320)</code></li>
</ul>
</li>
</ol>
</li>
<li><ol start="3">
<li>创建容器控件(固定布局、任意布局)<ul>
<li><code>layout := gtk.NewFixed()</code></li>
</ul>
</li>
</ol>
</li>
<li><ol start="4">
<li>布局添加到窗口上<ul>
<li><code>win.Add(layout)</code></li>
</ul>
</li>
</ol>
</li>
<li><ol start="5">
<li>显示控件<ul>
<li><code>win.ShowAll()</code>，否则一个一个show</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li>主事件循环</li>
</ul>
<h3 id="控件"><a href="#控件" class="headerlink" title="控件"></a>控件</h3><p>控件包含：属性、方法</p>
<h3 id="信号处理"><a href="#信号处理" class="headerlink" title="信号处理"></a>信号处理</h3><p>形如</p>
<ul>
<li>注册按钮处理点击事件<ul>
<li><code>b1.Connect(&quot;clicked&quot;, handlefunc, args)</code></li>
<li>也可以使用封装好的<code>b.Clicked(func(){})</code></li>
<li><code>handlefunc(ctx *glib.CallbackContext)</code>进行处理，接受args参数<ul>
<li>也可使用匿名函数</li>
</ul>
</li>
<li>使用<code>ctx.Data()</code>获取传入的参数。返回空接口类型，可以使用断言<ul>
<li><code>data, ok := ctx.Data().(string)</code>，如果是string类型则<code>if ok通过</code></li>
</ul>
</li>
</ul>
</li>
<li>关闭窗口触发destroy<ul>
<li><code>win.Connect(&quot;destroy&quot;, func(){gtk.MainQuit()}, args)</code></li>
</ul>
</li>
</ul>
<h2 id="使用glade辅助"><a href="#使用glade辅助" class="headerlink" title="使用glade辅助"></a>使用glade辅助</h2><ul>
<li>编辑好后加载glade文件：<ul>
<li><code>builder := gtk.NewBuilder()</code></li>
<li><code>builder.AddFromFile(&quot;xxx.glade&quot;)</code></li>
</ul>
</li>
<li>获取glade上的控件<ul>
<li><code>win := gtk.WindowFromObject(builder.GetObject(&quot;yourObjName&quot;))</code>，获取窗口</li>
<li>显示控件，如果是glade添加的控件，<code>show</code>即可显示所有<ul>
<li><code>win.Show()</code></li>
</ul>
</li>
<li>信号处理的方法页一样</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Travis TuRing</p>
  <div class="site-description" itemprop="description">Mens et Manus</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">63</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">57</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Travis TuRing</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
