<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/18/universe/database/Redis_study_note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/18/universe/database/Redis_study_note/" class="post-title-link" itemprop="url">Redis 学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-18 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-18T00:00:00+08:00">2020-03-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-15 21:34:14" itemprop="dateModified" datetime="2020-06-15T21:34:14+08:00">2020-06-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Redis学习笔记"><a href="#Redis学习笔记" class="headerlink" title="Redis学习笔记"></a>Redis学习笔记</h1><h2 id="基本认识"><a href="#基本认识" class="headerlink" title="基本认识"></a>基本认识</h2><ul>
<li>Redis 是单线程的, 也就是说在处理不当会导致阻塞<ul>
<li>不要使用长命令, 如: keys *</li>
</ul>
</li>
</ul>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li>高速<ul>
<li>内存中进行的</li>
</ul>
</li>
<li>&lt;++&gt;</li>
<li>&lt;++&gt;</li>
<li>&lt;++&gt;</li>
<li>&lt;++&gt;</li>
<li>&lt;++&gt;</li>
<li>&lt;++&gt;</li>
</ul>
<h2 id="通用命令"><a href="#通用命令" class="headerlink" title="通用命令"></a>通用命令</h2><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><table>
<thead>
<tr>
<th>command</th>
<th>desc</th>
<th>T(n)</th>
</tr>
</thead>
<tbody><tr>
<td>keys [pattern]</td>
<td>根据通配符号检索key</td>
<td>O(n)</td>
</tr>
<tr>
<td>get key</td>
<td>获取value</td>
<td>O(1)</td>
</tr>
<tr>
<td>mget key1 key2…</td>
<td>批量获取value</td>
<td>O(n)</td>
</tr>
<tr>
<td>getset key newvalue</td>
<td>set key newvalue并反会旧的value</td>
<td>O(1)</td>
</tr>
<tr>
<td>append key value</td>
<td>追加</td>
<td>O(1)</td>
</tr>
<tr>
<td>strlen key</td>
<td>长度</td>
<td>O(1)</td>
</tr>
</tbody></table>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><table>
<thead>
<tr>
<th>command</th>
<th>desc</th>
<th>T(n)</th>
</tr>
</thead>
<tbody><tr>
<td>set key value</td>
<td>设置 key value</td>
<td>O(1)</td>
</tr>
<tr>
<td>mset key1 value1 key2 value2…</td>
<td>批量设置 key value</td>
<td>O(1)</td>
</tr>
<tr>
<td>setnx key value</td>
<td>如果key不存在,设置 key value</td>
<td>O(1)</td>
</tr>
<tr>
<td>set key value xx</td>
<td>如果key存在,设置 key value</td>
<td>O(1)</td>
</tr>
<tr>
<td>dbsize</td>
<td>计算key总数</td>
<td>O(1)</td>
</tr>
<tr>
<td>exists key</td>
<td>判断存在</td>
<td>O(1)</td>
</tr>
<tr>
<td>del key [key …]</td>
<td>删除</td>
<td>O(1)</td>
</tr>
<tr>
<td>expire key seconds</td>
<td>key在seconds秒后过期</td>
<td>O(1)</td>
</tr>
<tr>
<td>ttl key</td>
<td>查看过期时间, -1没设置过期, -2已过期</td>
<td>O(1)</td>
</tr>
<tr>
<td>persist key</td>
<td>去掉过期时间</td>
<td>O(1)</td>
</tr>
<tr>
<td>type key</td>
<td>返回类型</td>
<td>O(1)</td>
</tr>
</tbody></table>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><table>
<thead>
<tr>
<th>command</th>
<th>desc</th>
<th>T(n)</th>
</tr>
</thead>
<tbody><tr>
<td>getrange key start end</td>
<td>获取字符串指定下标所有值</td>
<td>O(1)</td>
</tr>
<tr>
<td>setrange key index value</td>
<td>设置指定下标对应值</td>
<td>O(1)</td>
</tr>
</tbody></table>
<h3 id="数"><a href="#数" class="headerlink" title="数"></a>数</h3><table>
<thead>
<tr>
<th>command</th>
<th>desc</th>
<th>T(n)</th>
</tr>
</thead>
<tbody><tr>
<td>incr key</td>
<td>自增1</td>
<td>O(1)</td>
</tr>
<tr>
<td>decr key</td>
<td>自减1</td>
<td>O(1)</td>
</tr>
<tr>
<td>incrby key k</td>
<td>自增k</td>
<td>O(1)</td>
</tr>
<tr>
<td>decrby key k</td>
<td>自减k</td>
<td>O(1)</td>
</tr>
<tr>
<td>incrbyfloat key float</td>
<td>自增float</td>
<td>O(1)</td>
</tr>
</tbody></table>
<h3 id="哈希"><a href="#哈希" class="headerlink" title="哈希"></a>哈希</h3><p>结构: key -&gt; (field -&gt; value)</p>
<p>hash的所有命令都是h开头的<br>| command             | desc                         | T(n) |<br>|———————|——————————|——|<br>| hget                | &lt;++&gt;                         | &lt;++&gt; |<br>| hset                | &lt;++&gt;                         | &lt;++&gt; |<br>| hdel                | &lt;++&gt;                         | &lt;++&gt; |<br>| hexists key field   | &lt;++&gt;                         | &lt;++&gt; |<br>| hlen key            | count field                  | &lt;++&gt; |<br>| hmget               | &lt;++&gt;                         | &lt;++&gt; |<br>| hmset               | &lt;++&gt;                         | &lt;++&gt; |<br>| hincrby key value k | incrby k                     | &lt;++&gt; |<br>| hgetall             | get all (field,value) by key | O(n) |<br>| hvals key           | get all values by key        | &lt;++&gt; |<br>| hkeys key           | get all fields by key        | &lt;++&gt; |</p>
<h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p>结构: key -&gt; [list]</p>
<p>list的所有命令都是l开头的<br>| command                                 | desc                                                    | T(n)   |<br>|—————————————–|———————————————————|——–|<br>| rpush key value1 value2 …             | 从列表右端插入                                          | O(1-n) |<br>| lpush key value1 value2 …             | 从列表左端插入                                          | O(1-n) |<br>| linsert key before/after value newvalue | 在指定的value前/后插入newvalue                          | O(n)   |<br>| lpop key                                | 从列表左边弹出                                          | O(1)   |<br>| lrem key count value                    | 从左边删除count个value, 删除重复元素, count&lt;0从右边删除 | O(n)   |<br>| ltrim key start end                     | 裁剪出制定范围的元素                                    | O(n)   |<br>| lrange key start end(包含end)           | 获取指定范围的元素                                      | O(n)   |<br>| lindex key index                        | 索引取出                                                | O(n)   |<br>| llen key                                |                                                         | O(1)   |<br>| lset key index newvalue                 | 按照索引修改指                                          | &lt;++&gt;   |</p>
<h3 id="无序集合"><a href="#无序集合" class="headerlink" title="无序集合"></a>无序集合</h3><p>结构: key -&gt; set</p>
<ul>
<li>无需</li>
<li>无重复</li>
<li>支持集合间操作</li>
</ul>
<p>set所有命令s开头<br>| command                             | desc                     | T(n) |<br>|————————————-|————————–|——|<br>| sadd set element                    | insert element           | O(1) |<br>| srem set element                    | delete element           | O(1) |<br>| scard set                           | count element inside set | &lt;++&gt; |<br>| sismenber set                       | check if exists          | &lt;++&gt; |<br>| srandmember set count               | 随机取出count个          | &lt;++&gt; |<br>| spop set                            | 随机弹出1个              | &lt;++&gt; |<br>| smembers set                        | get all element          | &lt;++&gt; |<br>| sdiff set1 set2                     | 差集                     | &lt;++&gt; |<br>| sinter set1 set2                    | 交集                     | &lt;++&gt; |<br>| sunion set1 set2                    | 并集                     | &lt;++&gt; |<br>| sdiff/sinter/sunion + store destkey | 把结果保存到destkey中    | &lt;++&gt; |</p>
<h3 id="有序集合"><a href="#有序集合" class="headerlink" title="有序集合"></a>有序集合</h3><p>结构: key -&gt; (score -&gt; element)</p>
<ul>
<li>element不可重复</li>
<li>顺序由score定</li>
</ul>
<p>有序set所有命令z开头<br>| command                             | desc                                 | T(n)           |<br>|————————————-|————————————–|—————-|<br>| zadd key score element              | &lt;++&gt;                                 | $O(\log n)$    |<br>| zrem key element                    | &lt;++&gt;                                 | &lt;++&gt;           |<br>| zscore key element                  | get score by element                 | O(1)           |<br>| zincrby key increScore element      | 给element增加指定分数                | &lt;++&gt;           |<br>| zcard key                           |                                      | 返回个数       |<br>| zrank                               | 获取排名                             | &lt;++&gt;           |<br>| zrange key start end [withscores]   | 获取范围withscores选项是是否打印分值 | $O(\log(n)+m)$ |<br>| zrangebyscore key minScore maxScore | &lt;++&gt;                                 | &lt;++&gt;           |<br>| zcount key minScore maxScore        | &lt;++&gt;                                 | &lt;++&gt;           |<br>| zremrangebyrank key start end       | &lt;++&gt;                                 | &lt;++&gt;           |<br>| zremrangebyscore key start end      | &lt;++&gt;                                 | &lt;++&gt;           |</p>
<h3 id="慢查询"><a href="#慢查询" class="headerlink" title="慢查询"></a>慢查询</h3><p>生命周期</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">client-&gt;command queue: command</span><br><span class="line">Note right of command queue: Execute one command</span><br><span class="line">command queue--&gt;client: result</span><br></pre></td></tr></table></figure>

<p>慢查询发生在执行命令的过程, 如<code>keys *</code>就会发生慢查询, 通过配置慢查询来防止阻塞</p>
<table>
<thead>
<tr>
<th>配置</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td>config set slowlog-max-len value</td>
<td>慢查询队列的最大长度为value</td>
</tr>
<tr>
<td>config set slowlog-log-slower-than value</td>
<td>把慢于value微妙的命令放入慢查询队列, 一般设置1微妙</td>
</tr>
<tr>
<td>slowlog get [n]</td>
<td>获取慢查询队列</td>
</tr>
<tr>
<td>slowlog len</td>
<td>获取慢查询队列条数</td>
</tr>
<tr>
<td>slowlog reset</td>
<td>清空</td>
</tr>
</tbody></table>
<h3 id="流水线-Pipline"><a href="#流水线-Pipline" class="headerlink" title="流水线 Pipline"></a>流水线 Pipline</h3><p>网络通信时间 = 网络时间+命令时间</p>
<p>因为redis很快, 通信时间大多数时候受限于网络时间, 而且如果让redis同时mget, mset或者n次set是不行的, 这意味着就需要多次请求, 就会耗费很多时间</p>
<p>流水线的作用就是把一批命令批量打包, 发送到服务端, 然后按顺序反回, 这样n次网络时间就缩短为1次了</p>
<h3 id="发布订阅"><a href="#发布订阅" class="headerlink" title="发布订阅"></a>发布订阅</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">发布者publisher-&gt;频道redis server: 发布消息</span><br><span class="line">频道channle--&gt;订阅者subscribers: 订阅消息给订阅者1</span><br><span class="line">频道channle--&gt;订阅者subscribers: 订阅消息给订阅者2</span><br><span class="line">频道channle--&gt;订阅者subscribers: 订阅消息给订阅者3</span><br><span class="line">Note right of 订阅者subscribers: 每个订阅了频道的人都会收到消息</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>API</th>
<th>desc</th>
</tr>
</thead>
<tbody><tr>
<td>publish channel message</td>
<td>发送message到channel, 返回订阅者数</td>
</tr>
<tr>
<td>subscribe [channel] #一个或多个</td>
<td>订阅</td>
</tr>
<tr>
<td>unsubscribe [channel] #一个或多个</td>
<td>取消订阅</td>
</tr>
</tbody></table>
<p><strong>消息队列</strong> 类似发布订阅, 只是只有一个订阅者能收到, 类似强红包</p>
<h3 id="位图Bitmap"><a href="#位图Bitmap" class="headerlink" title="位图Bitmap"></a>位图Bitmap</h3><p>redis中对位进行操作, 字符串其实就是字符数组嘛, 每个字符又是一段二进制编码</p>
<table>
<thead>
<tr>
<th>API</th>
<th>desc</th>
</tr>
</thead>
<tbody><tr>
<td>setbit key offset value</td>
<td>设置, value只能是0,1</td>
</tr>
<tr>
<td>getbit key offset</td>
<td></td>
</tr>
<tr>
<td>bitcount key [start end]</td>
<td>获取指定范围1的个数</td>
</tr>
<tr>
<td>btop op destkey key [key…]</td>
<td>将多个位图进行交并非异或等操作, 把结果保存到destkey中</td>
</tr>
<tr>
<td>bitpos key tagetBit [start] [end]</td>
<td>计算位图指定范围(start, end单位是字节)第一个偏移量对应的值等于targetBit的位置</td>
</tr>
</tbody></table>
<h3 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h3><p>用极小的空间完成独立用户的统计</p>
<ul>
<li>有错误率</li>
<li>不能取单条数据</li>
</ul>
<p>本质结构还是string<br>| API                                      | desc                      |<br>|——————————————|—————————|<br>| pfadd key element [element..]            | 向hyperloglog添加元素     |<br>| pfcount key [key..]                      | 计算hyperloglog的独立总数 |<br>| pfmerge destkey sourcekey [sourcekey…] | 合并多个hyperloglog       |</p>
<h3 id="地理信息定位GEO"><a href="#地理信息定位GEO" class="headerlink" title="地理信息定位GEO"></a>地理信息定位GEO</h3><p>存储经纬度, 计算两地距离, 范围计算等</p>
<table>
<thead>
<tr>
<th>API</th>
<th>desc</th>
</tr>
</thead>
<tbody><tr>
<td>geo key longitude latitude member […]</td>
<td>添加地理位置信息</td>
</tr>
<tr>
<td>geopos key member […]</td>
<td>获取信息</td>
</tr>
<tr>
<td>geodist member1 member2</td>
<td>算距离</td>
</tr>
<tr>
<td>georadius</td>
<td>范围</td>
</tr>
</tbody></table>
<h2 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h2><p>由于Redis是将数据保存在内存中的, 所以需要持久化来异步的保存到磁盘上</p>
<h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><p>生成快照, 保存到硬盘中实现持久化</p>
<p>自动保存默认配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">save 900 1    # 如果900秒内改变了1条内容就自动保存</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">dbfilename dump.db  # 默认保存的文件</span><br><span class="line">dir .&#x2F;</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line">rdbcompression yes</span><br><span class="line">rdbchecksum yes  # 检验</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>API</th>
<th>desc</th>
<th>T(n)</th>
</tr>
</thead>
<tbody><tr>
<td>save</td>
<td>保存, 会造成阻塞</td>
<td>O(n)</td>
</tr>
<tr>
<td>bgsave</td>
<td>异步保存, 通过子进程来生成RDB, 也会阻塞(发生在fork中), 但非常快</td>
<td>O(n)</td>
</tr>
</tbody></table>
<h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><p>RDB的问题</p>
<ul>
<li>耗时, 耗性能<ul>
<li>生成快照会把整个文件保存到硬盘</li>
</ul>
</li>
<li>不可控, 丢失数据<ul>
<li>不论是自动保存还是手动保存, 都不可避免因宕机导致的数据丢失</li>
</ul>
</li>
</ul>
<p>AOF 类似写日志的形式保存每条redis命令, 恢复再根据这些命令恢复</p>
<p>AOF也不是直接把数据写道硬盘中, 那样很慢, 而是将数据写道缓冲区, 再根据策略写到硬盘</p>
<p>AOF的三种策略(默认)</p>
<ul>
<li>always<ul>
<li>每条命令都写到硬盘, I/O开销很大</li>
</ul>
</li>
<li>everysec<ul>
<li>每秒到写到硬盘, 有可能丢失1秒数据</li>
</ul>
</li>
<li>no<ul>
<li>操作系统决定什么时候写就什么时候写</li>
</ul>
</li>
</ul>
<h4 id="AOF重写"><a href="#AOF重写" class="headerlink" title="AOF重写"></a>AOF重写</h4><p>如set同一个key多次只保留最后一次的内容, 不保留过期的命令等等…</p>
<p>AOF重写实现的两种方式</p>
<ul>
<li>bgrewriteaof<ul>
<li>类似bgsave, 在子进程中进行</li>
</ul>
</li>
<li>使用重写配置<ul>
<li>配置<ul>
<li><code>auto-aof-rewrite-min-size</code>: AOF文件重写需要的尺寸</li>
<li><code>auto-aof-rewrite-percentage</code>: AOF文件重写需要的增长率</li>
</ul>
</li>
<li>统计<ul>
<li><code>aof_current_size</code>: AOF当前尺寸(字节)</li>
<li><code>aof_base_size</code>: AOF上次启动和重写的尺寸</li>
<li>配合配置就可以在一定时机重写</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>可用AOF配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br><span class="line">appendfilename &quot;appendonly-$&#123;port&#125;.aof&quot;</span><br><span class="line">appendsync everysec</span><br><span class="line">dir .&#x2F;bigdiskpath</span><br><span class="line">no-appendfsync-on-rewrite yes</span><br><span class="line">auto-aof-rewite-percentage 100</span><br><span class="line">auto-aof-rewite-min-size 64mb</span><br></pre></td></tr></table></figure>


<h3 id="RDB和AOF选择"><a href="#RDB和AOF选择" class="headerlink" title="RDB和AOF选择"></a>RDB和AOF选择</h3><table>
<thead>
<tr>
<th>命令</th>
<th>ROD</th>
<th>AOF</th>
</tr>
</thead>
<tbody><tr>
<td>启动优先级</td>
<td>低</td>
<td>高</td>
</tr>
<tr>
<td>体积</td>
<td>小</td>
<td>大</td>
</tr>
<tr>
<td>恢复速度</td>
<td>快</td>
<td>慢</td>
</tr>
<tr>
<td>数据安全性</td>
<td>丢失数据</td>
<td>有策略据定</td>
</tr>
<tr>
<td>轻重</td>
<td>重</td>
<td>轻</td>
</tr>
</tbody></table>
<h2 id="Redis复制原理"><a href="#Redis复制原理" class="headerlink" title="Redis复制原理"></a>Redis复制原理</h2><h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3><p>单机运行redis可能面临许多风险, I/O瓶颈, 宕机风险, qbs瓶颈. 等等问题</p>
<p>使用redis的主从复制就能很方便是实现一个高可用的分布式数据库</p>
<ul>
<li>一个master可以有多个slave</li>
<li>一个slave只能有一个master</li>
<li>数据流向是单向的, master到slave</li>
</ul>
<p>redis中从节点slave相当于主节点master的备份, 当master中<code>set key value</code>后, 从节点也进行的同样的操作</p>
<h3 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h3><ul>
<li>命令实现: <ul>
<li><code>redis-6380&gt; slaveof 127.0.0.1 6379</code>6380成为6379的从复制</li>
<li>取消复制<code>slaveof no one</code>, 不成为任何人的从节点</li>
</ul>
</li>
<li>修改配置文件<ul>
<li><code>slave of ip port</code></li>
<li><code>slave-read-only yes</code>, 从节点不做任何写的操作, 保证和主节点数据一样</li>
</ul>
</li>
</ul>
<h3 id="全量复制"><a href="#全量复制" class="headerlink" title="全量复制"></a>全量复制</h3><p>Redis的主从复制是异步操作, 也就是说同步过程中, 主节点可以发生改变, redis有机制能够保证同步过程发生的改变也同步到从节点中. 也就是全量复制</p>
<p><strong>全量复制过程</strong></p>
<ul>
<li>从主节点复制, 生成rdb文件</li>
<li>redis内部会记录复制期间主节点的变化</li>
<li>复制完成后比叫主从节点的偏移量来查看主节点是否有变化, 并将变化同步到从节点中</li>
</ul>
<p><strong>全量复制开销</strong></p>
<ul>
<li>bgsave时间</li>
<li>RDB文件网络传输时间</li>
<li>从节点清空时间</li>
<li>从节点加载RDB文件时间</li>
<li>可能的AOF重写时间</li>
</ul>
<h3 id="部分复制"><a href="#部分复制" class="headerlink" title="部分复制"></a>部分复制</h3><p>如果全量复制期间发生网络抖动等原因导致复制到从节点数据丢失或不完整, 再次进行全量复制显然是不合理的, 因为前面看到全量复制开销很大. 这时就有了部分复制</p>
<p>在全量复制开始时, 主节点会进行复制缓冲区命令. 当网络抖动结束后, 从节点再次尝试连接主节点, 并将自己的偏移量offset和runid发送给主节点<br>如果从节点的偏移量和主节点的偏移量小于某值(缓冲区内), 就会发生部分复制, 从从节点的offset开始复制, 发送给从节点.<br>否则就全量复制.</p>
<h3 id="故障处理"><a href="#故障处理" class="headerlink" title="故障处理"></a>故障处理</h3><ul>
<li>slave故障<ul>
<li>使用别的slave暂时代替</li>
</ul>
</li>
<li>master故障<ul>
<li>让slave成为新的master</li>
</ul>
</li>
</ul>
<h3 id="主从复制常见问题"><a href="#主从复制常见问题" class="headerlink" title="主从复制常见问题"></a>主从复制常见问题</h3><ul>
<li>读写分离<ul>
<li>用master写, 读的流量分摊到各个slave</li>
<li>可能问题:<ul>
<li>复制数据延迟</li>
<li>读到过期数据</li>
<li>从节点故障</li>
</ul>
</li>
</ul>
</li>
<li>配置不一致<ul>
<li>如maxmamory不一致导致数据丢失</li>
<li>如数据结构优化参数导致内存不一致</li>
</ul>
</li>
<li>规避全量复制<ul>
<li>第一次全量复制不可避免<ul>
<li>小主节点, 或者低峰值的时候进行</li>
</ul>
</li>
<li>节点运行ID不匹配<ul>
<li>主节点重启(运行ID变化)</li>
<li>故障转移</li>
</ul>
</li>
<li>复制积压缓冲区不足<ul>
<li>部分复制</li>
<li>增大复制换缓冲区配置<code>rel_backlog_size</code></li>
</ul>
</li>
</ul>
</li>
<li>复制风暴(主节点挂载了很多子节点, 当主节点宕机重启后, ID发生变化, 所有从节点都进行一次全量复制)<ul>
<li>单节点复制风暴<ul>
<li>分摊从节点到从节点的链式结构, 可以减轻主节点的压力, 当时结果复杂, 维护难度加大</li>
</ul>
</li>
<li>单机复制风暴, 单机器上都是主节点<ul>
<li>主节点分散多机器</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Redis-Sentinel"><a href="#Redis-Sentinel" class="headerlink" title="Redis Sentinel"></a>Redis Sentinel</h2><p>Redis Sentinel是redis的一个高可用实现, 解决故障节点的检测和完美迁移的一个客户端</p>
<h3 id="Redis-Sentinel框架"><a href="#Redis-Sentinel框架" class="headerlink" title="Redis Sentinel框架"></a>Redis Sentinel框架</h3><p>sentinel会对每个redis进行监控, 用户使用redis不再是直接使用redis, 而是通过sentinel间接使用redis.<br>当发生故障进行故障转移后, 客户端不再关心哪个redis成为了master, 只用关心sentinel告诉我们的结果. </p>
<p>Redis Sentinel其实是个sentinel集合, sentinel实现故障转移的过程如下:</p>
<ul>
<li>多个sentinel发现并确认master有问题</li>
<li>选举出一个sentinel作为领导</li>
<li>选出一个slave作为master</li>
<li>通知其余slave成为新master的slave</li>
<li>告知客户端主从变化</li>
<li>当老的master复活后, 使其成为新master的slave</li>
</ul>
<p>Redis Sentinel可以监控多套master和slave, 使用master-name的配置作为标识和说明</p>
<h3 id="Redis-Sentinel原理"><a href="#Redis-Sentinel原理" class="headerlink" title="Redis Sentinel原理"></a>Redis Sentinel原理</h3><p>Redis Sentinel内部会运行三个定时任务</p>
<ul>
<li>每10秒每个sentinal对master和slave执行info<ul>
<li>发现slave节点</li>
<li>确认主从关系</li>
</ul>
</li>
<li>每2秒每个sentinel通过master节点的channel交换信息(发布订阅)<ul>
<li>通过 __sentinel__:hello频道交互</li>
<li>交互节点的”看法”(失败判定)和自身信息</li>
</ul>
</li>
<li>每1秒每个sentinel对其他sentinel和redis执行ping<ul>
<li>心跳检测, 失败判定</li>
</ul>
</li>
</ul>
<h4 id="主观下线和客观下线"><a href="#主观下线和客观下线" class="headerlink" title="主观下线和客观下线"></a>主观下线和客观下线</h4><p>每个sentinel对节点的判定可能不同(受网络影响等等), 所以一个节点的判定是不真实的, 根据单个节点进行的主观下线也是不合理的.<br>所以下线操作要根据多个节点投票来决定, 称之为客观下线.</p>
<p><code>sentinel monitor &lt;masterName&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt;</code>quorum就是投票通过的判定, 多为奇数</p>
<h4 id="领导者选举"><a href="#领导者选举" class="headerlink" title="领导者选举"></a>领导者选举</h4><p>领导者选举使用raft算法</p>
<ul>
<li>选举: 通过sentinel is-master-down-by-addr命令都希望成为领导者<ul>
<li>每个主管下线的sentinel节点向其他sentinel节点发送该命令, 希望将它设置为领导者</li>
<li>收到命令的sentinel如果没有同意过其他sentinel节点发送的命令, 就会同意该请求, 否则拒绝</li>
<li>如果当前sentinal节点发现自己的票数超过sentinel集合半数且超过quorum, 则它成为领导者</li>
<li>如果此过程有多个sentinel节点成为领导者, 那么将等待一段时间再次进行选举</li>
</ul>
</li>
</ul>
<h4 id="故障转移-sentinel领导者完成"><a href="#故障转移-sentinel领导者完成" class="headerlink" title="故障转移(sentinel领导者完成)"></a>故障转移(sentinel领导者完成)</h4><ul>
<li>从slave节点选出”合适的”节点作为新的master</li>
<li>对上面的slave节点执行<code>slaveof no one</code>让其成为master</li>
<li>向剩余的slave节点发送命令, 让它们成为新的master节点的slave, 复制规则和<code>parallel-syncs</code>参数有关</li>
<li>更新对原来master节点的配置为slave, 并保持这对其”关注”, 当其恢复后命令它去复制新的master节点</li>
</ul>
<p><strong>slave节点的选择</strong> </p>
<ul>
<li>选择<code>slave-priority</code>(节点优先级)最高的slave节点, 如果存在则返回, 不存在进行下一步选择<ul>
<li>默认优先级的一样的, 可以根据机器配置高低手动配置</li>
</ul>
</li>
<li>选择复制偏移量最大的slave节点(越大说明越接近主节点, 越完整), 不存在则进行下一步</li>
<li>选择runId最小的slave节点</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li>配置开启主节点</li>
<li>配置开启sentinel监控主节点(<strong>sentinel是特殊的redis</strong>)</li>
<li>实际应该用多机器</li>
<li>详细配置节点</li>
</ul>
<p>配置开启主从节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port $&#123;port&#125;</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile &#x2F;path&#x2F;to&#x2F;pidfile.pid</span><br><span class="line">logfile &quot;logfile.log&quot;</span><br><span class="line">dir &quot;&#x2F;dir&#x2F;to&quot;</span><br><span class="line"></span><br><span class="line"># 从节点</span><br><span class="line">slaveof ip port</span><br></pre></td></tr></table></figure>

<p>sentinel主要配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">port $&#123;port&#125;</span><br><span class="line">daemonize yes</span><br><span class="line">dir &quot;path&#x2F;to&#x2F;dir&quot;</span><br><span class="line">logfile &quot;$&#123;port&#125;.log&quot;</span><br><span class="line"></span><br><span class="line">sentinel monitor master-name ip port 2  # 自定一个mastername, 2表示当两个sentinel认为这个主节点出问题时, 故障转移</span><br><span class="line">sentinel down-after-milliseconds master-name 30000  # 类似于ping的时间</span><br><span class="line">sentinel parallel-syncs master-name 1  # 允许老slave同时对新master进行复制的个数</span><br><span class="line">sentinel failover-timeout master-name 180000</span><br></pre></td></tr></table></figure>

<p>启动Redis Sentinel</p>
<ul>
<li><code>redis-sentinel [config file]</code></li>
<li>或者<code>redis-server --sentinel [config file]</code></li>
</ul>
<h3 id="客户端结合sentinel实现高可用"><a href="#客户端结合sentinel实现高可用" class="headerlink" title="客户端结合sentinel实现高可用"></a>客户端结合sentinel实现高可用</h3><p>sentinel实现的高可用, 如果客户端没有实现高可用, 对sentinel的感知不高, 那也并不是高可用的</p>
<ul>
<li>客户端遍历sentinel节点集合, 获取一个可用的sentinel节点</li>
<li>通过sentinal获取master节点<code>sentinel get-master-addr-by-name master-name</code></li>
<li><code>role</code>或者<code>role replication</code>验证是否是真的master节点</li>
<li>当master节点发生变化, 通知客户端(发布订阅的模式)</li>
</ul>
<p>各语言API有所不同</p>
<h4 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h4><p>主节点挂掉后, sentinel服务可以方便的帮我们完成故障迁移. 如果slave节点挂掉后, 我们应该通过一定的手段让客户端迁移, 不让故障节点影响到客户端.</p>
<p>三个迁移判断:</p>
<ul>
<li>切换主节点时(从节点晋升为主节点)</li>
<li>写换从节点时(主节点下降为从节点)</li>
<li>主观下线时</li>
</ul>
<p>客户端配合sentinel实现起来还是比较复杂的, 后面的集群更适合进行这样的读写分离</p>
<h3 id="主动下线"><a href="#主动下线" class="headerlink" title="主动下线"></a>主动下线</h3><p>有时候设备更新等原因, 需要关闭/重启/迁移服务器等等. 运维人员可以手动下线服务器的节点.<br><code>sentinel failover &lt;masterName&gt;</code> 手动让主机点下线, 然后sentinel会让它故障转移.</p>
<h3 id="节点上线"><a href="#节点上线" class="headerlink" title="节点上线"></a>节点上线</h3><ul>
<li>主节点: <code>sentinel failover &lt;masterName&gt;</code> 让重启的主节点重新成为主节点</li>
<li>从节点: <code>slaveof</code>即可, sentinel节点可以感知</li>
<li>sentinel节点: 参考其他sentinel节点启动即可, 订阅发布</li>
</ul>
<h2 id="Redis-Cluster"><a href="#Redis-Cluster" class="headerlink" title="Redis Cluster"></a>Redis Cluster</h2><h3 id="呼唤集群"><a href="#呼唤集群" class="headerlink" title="呼唤集群"></a>呼唤集群</h3><p>为什么需要呼唤</p>
<ul>
<li>并发量: OPS<ul>
<li>Redis官方数据每秒可以执行10万行, 但是如果业务要求100万/每秒呢</li>
</ul>
</li>
<li>数据量<ul>
<li>一般的计算机内存16~256G, 但是如果业务要求500G呢</li>
</ul>
</li>
<li>流量<ul>
<li>单机流量是千兆网卡, 但是业务要求万兆呢</li>
</ul>
</li>
</ul>
<p>分布式就是结局这些问题的好方法, 集群就相当于机柜. 规模化需求.</p>
<h3 id="数据分布"><a href="#数据分布" class="headerlink" title="数据分布"></a>数据分布</h3><p>全量分布 =&gt; 一定的分区规则 =&gt; 子集N</p>
<ul>
<li>顺序分区<ul>
<li>数据分散度易倾斜</li>
<li>键值业务相关<ul>
<li>如按日期的顺序分区</li>
</ul>
</li>
<li>可顺序访问</li>
<li>不支持批量操作</li>
</ul>
</li>
<li>哈希分区<ul>
<li>数据分散度高</li>
<li>键值与业务无关</li>
<li>无法顺序访问</li>
<li>支持批量操作</li>
</ul>
</li>
</ul>
<h4 id="哈希分布"><a href="#哈希分布" class="headerlink" title="哈希分布"></a>哈希分布</h4><ul>
<li>节点取余分区<ul>
<li>扩容时, 迁移率高</li>
<li>使用多倍扩容可以优化</li>
</ul>
</li>
<li>一致性哈希分区<ul>
<li>让节点分布在一个token环上(首尾相连的数组), 举行哈希运算后先后检索</li>
<li>节点伸缩时, 只影响附近的节点, 迁移量较小</li>
<li>伸缩时建议翻倍伸缩, 保证负载均衡</li>
</ul>
</li>
<li>虚拟槽分区<ul>
<li>Redis Cluster的分区方式, Redis Cluster有16384个节点, 开槽是对16384进行平均</li>
<li>按一定的范围划分虚拟槽, 每个节点对应一个槽, 任取一个节点计算key哈希运算的结果, 如果结果是是自己管辖的范围, 则通过redis cluster的节点通信告知目标节点</li>
</ul>
</li>
</ul>
<h3 id="集群搭建"><a href="#集群搭建" class="headerlink" title="集群搭建"></a>集群搭建</h3><p>Redis Cluster架构</p>
<ul>
<li>节点<ul>
<li><code>cluster-enabled: yes</code>以集群模式启动节点</li>
</ul>
</li>
<li>meet<ul>
<li>有一个节点向其他节点发送”meet”, 节点收到后回复</li>
<li>内部机制让于同一个节点”meet”的节点们能互通</li>
</ul>
</li>
<li>指派槽<ul>
<li>负载均衡</li>
</ul>
</li>
<li>复制<ul>
<li>保证高可用</li>
</ul>
</li>
</ul>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><h4 id="原生命令安装"><a href="#原生命令安装" class="headerlink" title="原生命令安装"></a>原生命令安装</h4><ul>
<li>配置开启节点<ul>
<li><code>port ${port}</code></li>
<li><code>daemonize yes</code></li>
<li><code>dir &quot;/path/to/&quot;</code></li>
<li><code>dbfilename &quot;dump-${port}.rdb&quot;</code></li>
<li><code>logfile &quot;${port}.log&quot;</code></li>
<li><code>cluster-enabled yes</code>  是cluser节点</li>
<li><code>cluster-config-file nodes-${port}.conf</code> 为当前节点单独选择配置文件</li>
<li><code>cluster-node-timeout 15000</code></li>
<li><code>cluster-require-full-coverage yes</code>  当集群中所有节点可以用时才提供服务, 默认是yes, 不符合高可用</li>
</ul>
</li>
<li>节点握手: meet<ul>
<li><code>cluster meet ip port</code></li>
</ul>
</li>
<li>指派槽<ul>
<li><code>cluster addslots slot [slot...]</code></li>
</ul>
</li>
<li>主从关系分配实现高可用<ul>
<li><code>cluster replicate node-id</code> node-id是值集群节点的id, 不是runid</li>
</ul>
</li>
</ul>
<h4 id="使用Ruby安装脚本"><a href="#使用Ruby安装脚本" class="headerlink" title="使用Ruby安装脚本"></a>使用Ruby安装脚本</h4><h3 id="集群伸缩"><a href="#集群伸缩" class="headerlink" title="集群伸缩"></a>集群伸缩</h3><p>集群搭建 = 虚拟槽和数据在节点之间移动</p>
<h4 id="集群扩容"><a href="#集群扩容" class="headerlink" title="集群扩容"></a>集群扩容</h4><ul>
<li>准备新集群节点</li>
<li>加入集群<ul>
<li><code>cluster meet ip port</code></li>
</ul>
</li>
<li>迁移槽和数据<ul>
<li>迁移计划: 槽的规划</li>
<li>迁移数据<ul>
<li>对目标节点发送: <code>cluster setslot {slot} importing {sourceNodeId}</code>, 让目标节点准备导入槽的数据</li>
<li>对源节点发送: <code>cluster setslot {slot} migraing {targetNodeId}</code>, 让源节点准备迁出槽数据 </li>
<li>源节点循环执行: <code>cluster getkeysinslot {slot} {count}</code>, 每次获取count个属于槽的键</li>
<li>在源节点上执行: <code>migrate {targetIp} {targetPort} key 0 {timeout}</code>, 把指定key迁移, 0是值数据库0, redis中只有db0</li>
<li>重复执行3-4直到槽下所有的键数据迁移到目标节点</li>
<li>向集群内所有主节点发送<code>cluster setslot {slot} node {targetNodeId}</code>, 通知槽分配给目标节点</li>
</ul>
</li>
<li>添加从节点</li>
</ul>
</li>
</ul>
<h4 id="集群缩容"><a href="#集群缩容" class="headerlink" title="集群缩容"></a>集群缩容</h4><ul>
<li>下线迁移槽<ul>
<li>因为节点是互通的, 下线一个节点就要让所有节点忘记它</li>
</ul>
</li>
<li>忘记节点<ul>
<li><code>redis-cli cluster forget {downNodeId}</code>, 有效时间60s, 60秒, 如果有一个节点没有忘记downNodeId的话就会恢复</li>
</ul>
</li>
<li>关闭节点</li>
</ul>
<h3 id="客户端路由"><a href="#客户端路由" class="headerlink" title="客户端路由"></a>客户端路由</h3><h4 id="moved重定向"><a href="#moved重定向" class="headerlink" title="moved重定向"></a>moved重定向</h4><p>客户端向某个发送键命令, 哈希计算后发现这条命令的的槽是当前节点控制的, 则执行. 否则回复moved异常. 包含槽 ip:port<br>客户端收到moved异常后, 再(如果不是集群模式的话, -c)手动向对应节点发送信息.</p>
<h4 id="ask重定向"><a href="#ask重定向" class="headerlink" title="ask重定向"></a>ask重定向</h4><p>因为槽迁移的比较慢的, 如果发送命令后返回了moved异常, 但当我们对目标节点再次发送命令后, 发现节点已经迁移了. 这就比较尴尬.</p>
<p>ask重定向就能解决这一问题. 客户端发送键命令到源节点, 但是发现节点此时正在做槽迁移, 那就会返回ask转向异常.<br>当我们收到ask转向异常后, 我们向目标节点发送<code>Asking</code>命令, 再发送要执行的命令</p>
<ul>
<li>moved: 槽在确定节点中</li>
<li>ask: 槽在迁移中, 不确定在哪个节点</li>
</ul>
<h4 id="smart客户端-追求性能"><a href="#smart客户端-追求性能" class="headerlink" title="smart客户端: 追求性能"></a>smart客户端: 追求性能</h4><h3 id="批量操作"><a href="#批量操作" class="headerlink" title="批量操作"></a>批量操作</h3><p>当分布到多个节点后要怎么一次对所有节点进行操作呢?</p>
<ul>
<li>串行mget<ul>
<li>效率底</li>
<li>n次网络时间</li>
</ul>
</li>
<li>串行IO<ul>
<li>在本地算出key的槽, 然后根据redis的的分组, 把key集中到一起再去访问redis对应的node(pipline)</li>
<li>nodes次网络时间</li>
</ul>
</li>
<li>并行IO<ul>
<li>多线程地执行串行IO</li>
</ul>
</li>
<li>hash_tag<ul>
<li>性能最高但读写增加tag维护成本, tag分布容易倾斜</li>
</ul>
</li>
</ul>
<h3 id="Redis-Cluster的故障转移"><a href="#Redis-Cluster的故障转移" class="headerlink" title="Redis Cluster的故障转移"></a>Redis Cluster的故障转移</h3><h4 id="故障发现"><a href="#故障发现" class="headerlink" title="故障发现"></a>故障发现</h4><p>节点间ping/pong, 原理类似sentinel</p>
<ul>
<li>主管下线</li>
<li>客观下线</li>
</ul>
<h4 id="故障恢复"><a href="#故障恢复" class="headerlink" title="故障恢复"></a>故障恢复</h4><ul>
<li>检查资格<ul>
<li>检查slave成为主节点的资格</li>
</ul>
</li>
<li>选举</li>
<li>替换主节点</li>
</ul>
<h2 id="缓存的设计"><a href="#缓存的设计" class="headerlink" title="缓存的设计"></a>缓存的设计</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">request-&gt;cache: request</span><br><span class="line">cache--&gt;request: response</span><br><span class="line">cache-&gt;storage: request</span><br><span class="line">storage-&gt;cache: response</span><br><span class="line">storage--&gt;request: response</span><br></pre></td></tr></table></figure>

<ul>
<li>收益<ul>
<li>加速读写</li>
<li>降低后端负担<ul>
<li>如降低后端MySQL负担</li>
</ul>
</li>
</ul>
</li>
<li>成本<ul>
<li>数据不一致: 缓存层和数据层有时间窗口不一致, 和更新策略有关<ul>
<li>如数据库更新了, 缓存没更新</li>
</ul>
</li>
<li>代码维护成本</li>
<li>运维成本</li>
</ul>
</li>
</ul>
<h3 id="缓存更新策略"><a href="#缓存更新策略" class="headerlink" title="缓存更新策略"></a>缓存更新策略</h3><ul>
<li>LRU/LFU/FIFO算法剔除: 如maxmemory-policy</li>
<li>超时剔除: 如expire</li>
<li>主动更新: 开发控制生命周期</li>
</ul>
<p>随机应变</p>
<table>
<thead>
<tr>
<th>策略</th>
<th>一致性</th>
<th>维护成本</th>
</tr>
</thead>
<tbody><tr>
<td>LRU/LFU/FIFO算法剔除</td>
<td>最差</td>
<td>低</td>
</tr>
<tr>
<td>超时剔除</td>
<td>较差</td>
<td>低</td>
</tr>
<tr>
<td>主动更新</td>
<td>强</td>
<td>高</td>
</tr>
</tbody></table>
<p>建议</p>
<ul>
<li>低一致性: 最大内存和淘汰策略</li>
<li>高一致性: 超时剔除和主动更新结合, 最大内存和淘汰策略兜底</li>
</ul>
<h3 id="缓存粒度控制"><a href="#缓存粒度控制" class="headerlink" title="缓存粒度控制"></a>缓存粒度控制</h3><p>三个角度</p>
<ul>
<li>通用性: 全量属性更好</li>
<li>占用空间: 部分属性更好</li>
<li>代码维护: 表面上全量属性更好</li>
</ul>
<h3 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h3><p>当大量请求不命中时, 及请求的数据不存在, 那缓存相当于没有作用, 还得每次从存储层读取遍历, 增大存储曾负载</p>
<p>原因</p>
<ul>
<li>业务代码自身问题</li>
<li>恶意攻击, 爬虫等</li>
</ul>
<p>如何发现</p>
<ul>
<li>业务的相应时间</li>
<li>业务本身问题</li>
<li>相关指标</li>
</ul>
<p>解决方法</p>
<ul>
<li>缓存空对象<ul>
<li>两个问题<ul>
<li>需要更多的键</li>
<li>缓存层和存储层”短期”不一致</li>
</ul>
</li>
</ul>
</li>
<li>布隆过滤器拦截<ul>
<li>用较小的内存实现过滤</li>
<li>也要根据实际情况使用</li>
</ul>
</li>
</ul>
<h3 id="无底洞问题"><a href="#无底洞问题" class="headerlink" title="无底洞问题"></a>无底洞问题</h3><p>加机器反而性能下降. 如当节点个数很多时, 客户端向节点发送批量操作命令(如mget), 那么这么多的节点就会导致网络时间非超明显</p>
<p>问题关键点</p>
<ul>
<li>更多的机器!=更高的性能</li>
<li>批量接口需求(mget, mset等)</li>
<li>数据增长与水平扩展需求</li>
</ul>
<p>优化IO的几种方法</p>
<ul>
<li>命令本身优化: 如慢查询keys, hgetall bigkey</li>
<li>减少网络通信次数<ul>
<li>数据库不同而不同</li>
</ul>
</li>
<li>降低接入成本: 如客户端长连接/连接池, NIO等</li>
</ul>
<h3 id="热点key重建"><a href="#热点key重建" class="headerlink" title="热点key重建"></a>热点key重建</h3><p>缓存重建的时间到了, 但这时有个热点key, 热点key性能消耗很大, 会导致重建的时间变长</p>
<p>三个目标:</p>
<ul>
<li>减少重建缓存的次数<ul>
<li>由于网络延迟等原因, 当地一个请求发现需要重建缓存时, 进行重建换成, 但这个热点key会有很多请求在统一时间发送, 会有很多重建缓存的命令</li>
</ul>
</li>
<li>数据尽可能一致</li>
<li>减少潜在风险</li>
</ul>
<h4 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h4><ul>
<li>互斥锁(mutex key)<ul>
<li>重建一次只能接收一个命令, 其他重建命令要等待重建完成<ul>
<li>但是会存在等待时间, 浪费内存</li>
<li>代码复杂度增加</li>
<li>存在锁死风险</li>
</ul>
</li>
</ul>
</li>
<li>永不过期<ul>
<li>缓存上不设置过期时间, 但不代表它不会更新</li>
<li>功能层面(逻辑过期), 会使用一个线程后台的更新缓存, 这样就不存在等待时间的问题<ul>
<li>但是这样会导致数据不一致</li>
<li>逻辑过期时间维护成本和内存成本增加</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Redis云平台CacheCloud"><a href="#Redis云平台CacheCloud" class="headerlink" title="Redis云平台CacheCloud"></a>Redis云平台CacheCloud</h2><p>当节点数量很多时, 运维就会遇到问题.</p>
<ul>
<li>发布构建繁琐, 私搭乱搭</li>
<li>节点&amp;机器等运维成本</li>
<li>监控报警初级</li>
</ul>
<p>可以自己写脚本, 当然网上也有很多开源项目</p>
<p>CacheCloud开源项目能够:</p>
<ul>
<li>一键开启Redis</li>
<li>机器, 应用, 实例监控和报警</li>
<li>客户端: 透明使用, 性能上报</li>
<li>可视化运维</li>
<li>已存在Redis直接接入和数据迁移</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/02/universe/js_ts/typescript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/02/universe/js_ts/typescript/" class="post-title-link" itemprop="url">TypeScript</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-02 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-02T00:00:00+08:00">2020-03-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-15 21:34:14" itemprop="dateModified" datetime="2020-06-15T21:34:14+08:00">2020-06-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h1><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>typescript是编译型,编译成javascript(解释型).</p>
<ul>
<li>安装<ul>
<li><code>npm install -g typescript</code></li>
</ul>
</li>
<li>编译<ul>
<li><code>tsc hello.ts</code></li>
</ul>
</li>
<li>编写react时以.tsx为后缀</li>
</ul>
<h2 id="强类型"><a href="#强类型" class="headerlink" title="强类型"></a>强类型</h2><h3 id="指定类型"><a href="#指定类型" class="headerlink" title="指定类型"></a>指定类型</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str:<span class="built_in">string</span> = <span class="string">"1"</span>;</span><br><span class="line"><span class="keyword">var</span> num:<span class="built_in">number</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> bool:<span class="built_in">boolean</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">var</span> un:<span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">var</span> nil:<span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> a:<span class="built_in">any</span>;</span><br><span class="line">a = <span class="number">1</span>;</span><br><span class="line">a = <span class="string">"1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> func1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>):<span class="title">void</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> func2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>):<span class="title">number</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没有赋值,表示是any值,以后不管怎么赋值都是any值的类型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a2;</span><br><span class="line">a2 = <span class="number">1</span>;</span><br><span class="line">a2 = <span class="string">"1"</span>;</span><br></pre></td></tr></table></figure>

<p>联合类型,方法只能调用类型公共的方法</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> strnum:<span class="built_in">string</span>|<span class="built_in">number</span> = <span class="string">"1"</span>;</span><br><span class="line"><span class="comment">// strnum.length() 就不行</span></span><br><span class="line">strnum.toString()</span><br></pre></td></tr></table></figure>

<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>类似java的接口,’子类必须实现接口’</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Inf&#123;</span><br><span class="line">    name:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj:Inf;</span><br><span class="line">obj = &#123;name:<span class="string">"ring"</span>&#125;  <span class="comment">// 没有赋值会报错</span></span><br></pre></td></tr></table></figure>

<p>可选属性</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Inf&#123;</span><br><span class="line">    name:<span class="built_in">string</span>,</span><br><span class="line">    age?:<span class="built_in">number</span>  <span class="comment">// 可选类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj:Inf;</span><br><span class="line">obj = &#123;name:<span class="string">"ring"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>不确定数量属性</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Inf&#123;</span><br><span class="line">    name:<span class="built_in">string</span>,</span><br><span class="line">    age?:<span class="built_in">number</span>, <span class="comment">// 可选类型</span></span><br><span class="line">    [propName:<span class="built_in">string</span>]:<span class="built_in">any</span>  <span class="comment">// 不确定数量的propName(strng类型),他的值是any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj:Inf;</span><br><span class="line">obj = &#123;name:<span class="string">"ring"</span>, age:<span class="number">10</span>, sex:man&#125;</span><br></pre></td></tr></table></figure>

<p>只读属性</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Inf&#123;</span><br><span class="line">    name:<span class="built_in">string</span>,</span><br><span class="line">    readonly age:<span class="built_in">number</span>  <span class="comment">// 只读属性</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj:Inf;</span><br><span class="line">obj = &#123;name:<span class="string">"ring"</span>, age:<span class="number">10</span>, sex:man&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>类型方括号</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr:<span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">var</span> arr2:<span class="built_in">any</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<p>泛型定义法</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr:<span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">var</span> arr2:<span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<p>接口定义法</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> IArr&#123;</span><br><span class="line">    [index:<span class="built_in">number</span>]:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> arr:IArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型除了是内置的类型, 还可以是接口的类型</span></span><br><span class="line"><span class="keyword">interface</span> Istate&#123;</span><br><span class="line">    name:<span class="built_in">string</span>,</span><br><span class="line">    age:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IArr&#123;</span><br><span class="line">    [index:<span class="built_in">number</span>]:Istate</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> arr:IArr = [&#123;name:<span class="string">"ring"</span>, age:<span class="number">20</span>&#125;]</span><br><span class="line"><span class="keyword">var</span> arr:<span class="built_in">Array</span>&lt;IArr&gt; = [&#123;name:<span class="string">"ring"</span>, age:<span class="number">20</span>&#125;]</span><br><span class="line"><span class="keyword">var</span> arr:Istate[] = [&#123;name:<span class="string">"ring"</span>, age:<span class="number">20</span>&#125;]</span><br></pre></td></tr></table></figure>

<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>声明式函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数名 参数名:类型  :返回类型</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">name:<span class="built_in">string</span>, age:<span class="built_in">number</span></span>):<span class="title">number</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> age:<span class="built_in">number</span> = func(<span class="string">"ring"</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>函数参数不确定</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">name:<span class="built_in">string</span>, age:<span class="built_in">number</span>, sex?:<span class="built_in">string</span></span>):<span class="title">number</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> age:<span class="built_in">number</span> = func(<span class="string">"ring"</span>, <span class="number">20</span>, <span class="string">"man"</span>)</span><br></pre></td></tr></table></figure>

<p>参数默认值</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">name:<span class="built_in">string</span>, age:<span class="built_in">number</span>, sex?:<span class="built_in">string</span>="man"</span>):<span class="title">number</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> age:<span class="built_in">number</span> = func(<span class="string">"ring"</span>, <span class="number">20</span>, <span class="string">"man"</span>)</span><br></pre></td></tr></table></figure>

<p>表达式类型函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params">name:<span class="built_in">string</span>, age:<span class="built_in">number</span></span>):<span class="title">number</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> age:<span class="built_in">number</span> = func(<span class="string">"ring"</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>表达式类型函数变量的约束规范</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 变量  约束  类型</span></span><br><span class="line"><span class="keyword">var</span> func:<span class="function">(<span class="params">name:<span class="built_in">string</span>, age:<span class="built_in">number</span></span>)=&gt;</span><span class="built_in">number</span> = <span class="function"><span class="keyword">function</span>(<span class="params">name:<span class="built_in">string</span>, age:<span class="built_in">number</span></span>):<span class="title">number</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> age:<span class="built_in">number</span> = func(<span class="string">"ring"</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者使用接口</span></span><br><span class="line"><span class="keyword">interface</span> Istate&#123;</span><br><span class="line">    (name:<span class="built_in">string</span>, age:<span class="built_in">number</span>):<span class="built_in">number</span>  <span class="comment">// (参数):返回类型</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> func:Istate = <span class="function"><span class="keyword">function</span>(<span class="params">name:<span class="built_in">string</span>, age:<span class="built_in">number</span></span>):<span class="title">number</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> age:<span class="built_in">number</span> = func(<span class="string">"ring"</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>采用重载的方式支持联合类型的函数关系</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">value:<span class="built_in">string</span></span>):<span class="title">string</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">value:<span class="built_in">number</span></span>):<span class="title">number</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">value:<span class="built_in">string</span>|<span class="built_in">number</span></span>)</span>&#123;  <span class="comment">// 这是上面的实现</span></span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a:<span class="built_in">number</span> = func(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> b:<span class="built_in">string</span> = func(<span class="string">"1"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h3><p>在联合类型的情况下, 调用的函数要是共有的函数, 不然会报错, 所以需要进行断言</p>
<p>&lt;类型&gt;值 或 值as类型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">name:<span class="built_in">string</span>|<span class="built_in">number</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (&lt;<span class="built_in">string</span>&gt;name).length()</span><br><span class="line">    <span class="comment">// 或者return (name as string).length()</span></span><br><span class="line">    <span class="comment">// 只能转换成联合类型中存在的类型</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// !! jsx/tsx中必须采用后一种 !!</span></span><br></pre></td></tr></table></figure>

<h3 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> strtype = <span class="built_in">string</span>|<span class="built_in">number</span>;</span><br><span class="line"><span class="keyword">var</span> str:strtype = <span class="string">"10"</span></span><br><span class="line">str = <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>对于接口</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> muchType1&#123;</span><br><span class="line">    name:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> muchType2&#123;</span><br><span class="line">    age:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> muchType = muchType1|muchType2</span><br><span class="line"><span class="keyword">var</span> obj1:muchType = &#123;name:<span class="string">"ring"</span>&#125;</span><br><span class="line"><span class="keyword">var</span> obj2:muchType = &#123;age:<span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">var</span> obj3:muchType = &#123;name:<span class="string">"ring"</span>, age:<span class="number">1</span>&#125;  <span class="comment">// 一种或多种或全部</span></span><br></pre></td></tr></table></figure>

<p>限制字符串的选择</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> sex = <span class="string">"man"</span>|<span class="string">"woman"</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">s:sex</span>):<span class="title">string</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line">func(<span class="string">"man"</span>)</span><br><span class="line"><span class="comment">// func("an") 就不行</span></span><br></pre></td></tr></table></figure>

<h3 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h3><p>使用枚举可以定义一些有名字的数字常量</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> Days&#123;</span><br><span class="line">    Sun,  <span class="comment">// 默认第一个取值为0</span></span><br><span class="line">    Mon,  <span class="comment">// 后面的一次累加</span></span><br><span class="line">    Tue,</span><br><span class="line">    Wed,</span><br><span class="line">    Thu,</span><br><span class="line">    Fri,</span><br><span class="line">    Sat,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Days.Sun)</span><br></pre></td></tr></table></figure>

<p>typescript枚举出来会自动赋值外, 同时会对枚举值到枚举名的反向映射, 就是变成了双向映射</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ts编译成js后的结果</span></span><br><span class="line"><span class="comment">// 即Days[0] = "Sun"</span></span><br><span class="line"><span class="keyword">var</span> Days;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">Days</span>) </span>&#123;</span><br><span class="line">    Days[Days[<span class="string">"Sun"</span>] = <span class="number">0</span>] = <span class="string">"Sun"</span>;</span><br><span class="line">    Days[Days[<span class="string">"Mon"</span>] = <span class="number">1</span>] = <span class="string">"Mon"</span>;</span><br><span class="line">    Days[Days[<span class="string">"Tue"</span>] = <span class="number">2</span>] = <span class="string">"Tue"</span>;</span><br><span class="line">    Days[Days[<span class="string">"Wed"</span>] = <span class="number">3</span>] = <span class="string">"Wed"</span>;</span><br><span class="line">    Days[Days[<span class="string">"Thu"</span>] = <span class="number">4</span>] = <span class="string">"Thu"</span>;</span><br><span class="line">    Days[Days[<span class="string">"Fri"</span>] = <span class="number">5</span>] = <span class="string">"Fri"</span>;</span><br><span class="line">    Days[Days[<span class="string">"Sat"</span>] = <span class="number">6</span>] = <span class="string">"Sat"</span>;</span><br><span class="line">&#125;)(Days || (Days = &#123;&#125;));</span><br><span class="line"><span class="built_in">console</span>.log(Days.Sun);</span><br></pre></td></tr></table></figure>

<h3 id="类的修饰符"><a href="#类的修饰符" class="headerlink" title="类的修饰符"></a>类的修饰符</h3><p>public private protected</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Person&#123;</span><br><span class="line">    name = <span class="string">"ring"</span>,</span><br><span class="line">    <span class="keyword">private</span> age = <span class="number">20</span>,</span><br><span class="line">    <span class="keyword">protected</span> say()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"halo"</span>)</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 没有修饰的话, 类中的属性后方法默认是public</span></span><br><span class="line"><span class="comment">// private 属性只能在类中被访问</span></span><br><span class="line"><span class="comment">// protected 只能在类及其子类中访问</span></span><br></pre></td></tr></table></figure>

<p>类的继承</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Child <span class="keyword">extends</span> Person&#123;</span><br><span class="line">    callParent()&#123;</span><br><span class="line">        <span class="keyword">super</span>.say()  <span class="comment">// super能拿到父类的对象, 所以能访问父类公开的属性和方法</span></span><br><span class="line">        <span class="comment">// 类中也能访问父类protected的方法, 类外就不行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态方法, 可以通过类名调用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Child <span class="keyword">extends</span> Person&#123;</span><br><span class="line">    callParent()&#123;</span><br><span class="line">        <span class="keyword">super</span>.say()  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> test()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"halo"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Child.test())  <span class="comment">// 但在静态方法中不可以使用this</span></span><br></pre></td></tr></table></figure>

<h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><p>泛型是指在定义函数, 接口或类的时候, 不预先指定具体类型, 而在使用的时候再指定类型的一种特性.<br>也可以帮助我们限定约束规范</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用T来统一类型, T可以是任何名字</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>&lt;<span class="title">T</span>&gt;(<span class="params">len:<span class="built_in">number</span>, value:&lt;T&gt;</span>):<span class="title">Array</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arr = []</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;<span class="number">1</span>++)&#123;</span><br><span class="line">        arr[i] = value</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> strArry: <span class="built_in">string</span>[] = func&lt;<span class="built_in">string</span>&gt;(<span class="number">3</span>, <span class="string">'1'</span>)  <span class="comment">// 制定类型为string</span></span><br><span class="line"><span class="keyword">var</span> numArry: <span class="built_in">number</span>[] = func(<span class="number">3</span>, <span class="number">1</span>)  <span class="comment">// 右边也可以不指定类型, 因为左边要求就收的是number, 所以它会反推</span></span><br></pre></td></tr></table></figure>

<p>接口采用泛型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Istate&#123;</span><br><span class="line">    &lt;T&gt;(name:<span class="built_in">string</span>, value:T):<span class="built_in">Array</span>&lt;T&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> func:Istate;</span><br><span class="line"><span class="comment">// 接口约束函数返回值</span></span><br><span class="line">func = <span class="function"><span class="keyword">function</span>&lt;<span class="title">T</span>&gt;(<span class="params">name:<span class="built_in">string</span>, value:T</span>):<span class="title">Array</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用时指定类型</span></span><br><span class="line"><span class="keyword">var</span> strArry:<span class="built_in">string</span> [] = func(<span class="string">"ring"</span>, <span class="string">"2020"</span>)  <span class="comment">// 2020就指定了类型是string</span></span><br><span class="line"><span class="keyword">var</span> numArry:<span class="built_in">number</span> [] = func(<span class="string">"ring"</span>, <span class="number">2020</span>)  <span class="comment">// 同理</span></span><br></pre></td></tr></table></figure>










      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/28/universe/python/python_level_up/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/28/universe/python/python_level_up/" class="post-title-link" itemprop="url">Python补完计划</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-28 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-28T00:00:00+08:00">2020-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-07-11 11:29:21" itemprop="dateModified" datetime="2020-07-11T11:29:21+08:00">2020-07-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="python提高"><a href="#python提高" class="headerlink" title="python提高"></a>python提高</h2><h3 id="GIL-全局解释器锁"><a href="#GIL-全局解释器锁" class="headerlink" title="GIL(全局解释器锁)"></a>GIL(全局解释器锁)</h3><p>保证多线程程序同一时间只有一个线程在执行。多个线程先强锁。</p>
<p>c语言写的python解释器存在GIL。</p>
<p>一面试题</p>
<blockquote>
<p>描述python GIL的概念，以及它对python多线程的影响。编写一个多线程抓取网页的程序，并阐明多线程抓取程序是否比单线程性能有提升，并解释原因</p>
</blockquote>
<p>参考答案</p>
<blockquote>
<ul>
<li><ol>
<li>python语言和GIL没有半毛钱关系。仅仅是由于历史原因在Cpython解释器，难以移除GIL</li>
</ol>
</li>
<li><ol start="2">
<li>GIL：全局解释器锁。每个线程在执行的过程都需要先抢GIL，保证同一时刻只有一个线程可以执行</li>
</ol>
</li>
<li><ol start="3">
<li>线程释放GIL锁的情况：在IO操作等可能会引起阻塞的system call之前，可以暂时释放GIL，但在执行完毕后，必须重新获取GIL python3.x使用计时器(执行时间到达阀值后，当前线程释放GIL)或python2.x的tickels计数到100</li>
</ol>
</li>
<li><ol start="4">
<li>python使用多进程可以利用多核CPU资源</li>
</ol>
</li>
<li><ol start="5">
<li>多线程爬取性能有提升，因为遇到IO阻塞(如网络)会自动释放GIL锁</li>
</ol>
</li>
</ul>
</blockquote>
<p>IO密集型程序适合用多线程</p>
<h3 id="深拷贝、浅拷贝"><a href="#深拷贝、浅拷贝" class="headerlink" title="深拷贝、浅拷贝"></a>深拷贝、浅拷贝</h3><p>赋值语句在python中一般都是引用</p>
<ul>
<li>深拷贝<code>copy.deepcopy</code><ul>
<li><code>import copy</code></li>
<li><code>b = copy.deepcopy(a)</code></li>
<li><code>id(a) != id(b)</code></li>
<li>如果拷贝的是元祖，且元祖里有可变的数据，设元祖a，则deepcopy结果<code>id(a)!=id(b)</code></li>
</ul>
</li>
<li>浅拷贝<code>copy.copy</code><ul>
<li><code>import copy</code></li>
<li><code>b = copy.copy(a)</code></li>
<li><code>id(a) != id(b)</code></li>
<li>但是如果拷贝的是元祖，且元祖里只有普通数据(不可变的)，设元祖a，则copy结果<code>id(a)==id(b)</code><ul>
<li>因为元祖是不可变类型，增删改都没用所以拷贝有什么用，所有就不拷贝</li>
</ul>
</li>
</ul>
</li>
<li>切片也是浅拷贝</li>
<li>字典<code>key: value</code>，value是指向别处的引用</li>
<li>浅拷贝和深拷贝的区别  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">b = [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">c = [a, b]  <span class="comment"># c中的a、b都是引用，引用指向两个列表</span></span><br><span class="line">d = copy.deepcopy(c)</span><br><span class="line">e = copy.copy(c)</span><br><span class="line"><span class="comment"># 虽然id(c)!=id(e)但是e中的[1, 2]、[3, 4]仍是a、b的引用，仅仅是把c的东西原封不动复制到e</span></span><br></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="私有化"><a href="#私有化" class="headerlink" title="私有化"></a>私有化</h3><p>不同于面向对象的语言，python没有public、private等关键字。</p>
<ul>
<li>xx：共有变量</li>
<li>_x：单前置下划线，私有化属性或方法，<code>from somemodule import *</code>不会导入<code>_x</code>变量，类和对象子类可以访问</li>
<li>__xx：双前置下划线，私有化属性或方法，避免与子类中的属性冲突，无法在外部直接访问(名字重整所以访问不到)</li>
<li>__xx__：双前后下划线，用户名字空间的魔法对象属性，非私有</li>
<li>xx_：单后置下划线，用于避免与python关键词的冲突</li>
</ul>
<h3 id="import问题"><a href="#import问题" class="headerlink" title="import问题"></a>import问题</h3><p>程序执行时添加新的模块路径</p>
<p><code>sys.path</code>是个储存了模块路径的列表，因此可以使用列表操作改变搜索路径的优先级以及添加新路径</p>
<h4 id="重新导入模块问题"><a href="#重新导入模块问题" class="headerlink" title="重新导入模块问题"></a>重新导入模块问题</h4><p>import会防止模块重复导入，如果在程序执行期间修改了模块，即使使用import再次导入，修改的模块不会更新。需要使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> imp <span class="keyword">import</span> reload</span><br><span class="line"></span><br><span class="line">reload(somemodule)  <span class="comment"># 使用这种方式在不退出程序的情况下重新导入模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 但是对于from aa import bb这样的需求没有办法</span></span><br></pre></td></tr></table></figure>


<h4 id="多模块导入问题"><a href="#多模块导入问题" class="headerlink" title="多模块导入问题"></a>多模块导入问题</h4><p>在大型项目中一般会把很长的代码拆分成很多小的模块，这时模块间的数据传递就需要注意。一般把公共数据放在一个模块，这样方便访问、修改。</p>
<p><code>import aa</code>，<code>aa.bb = a</code>和<code>from aa import bb</code>，<code>bb=a</code>的区别</p>
<ul>
<li><code>import aa</code>使aa指向模块，则<code>aa.bb = a</code>是对模块aa的bb赋值，会改变aa中bb的值</li>
<li><code>from aa import bb</code>使得变量bb <strong>指向</strong> 模块aa中的同名变量bb，如果使用<code>bb = a</code>使得bb的指向改变，不会改变aa中的bb的值</li>
</ul>
<h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><h4 id="多继承以及MRO顺序"><a href="#多继承以及MRO顺序" class="headerlink" title="多继承以及MRO顺序"></a>多继承以及MRO顺序</h4><ul>
<li>调用父类方法的方式<ul>
<li><ol>
<li>通过父类的名字调用<ul>
<li>缺点是会根据类递归的调用，无形中造成资源浪费。如<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Class A:</span><br><span class="line">    __init__(self):</span><br><span class="line">        new_socket</span><br><span class="line">Class B(A):</span><br><span class="line">    __init__(self):</span><br><span class="line">        A.__init__(self)</span><br><span class="line">Class C(A):</span><br><span class="line">    __init__(self):</span><br><span class="line">        A.__init__(self)</span><br><span class="line">Class D(B, C):</span><br><span class="line">    __init__(self):</span><br><span class="line">        B.__init__(self)</span><br><span class="line">        C.__init__(self) </span><br><span class="line"><span class="comment"># B和C的init分别调用A的init导致多创建一个socket，造成浪费</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
</li>
<li><ol start="2">
<li>通过<code>super().xxx</code>调用<ul>
<li>不是更具类递归的调用，而是根据<code>ClassName.__mro__</code>中的顺序调用，保证了每个类只调用一次</li>
<li>如果多继承了多个同名方法，则根据<code>ClassName.__mro__</code>中的顺序决定super().xxx调用的是哪个(先后顺序)<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Class A:</span><br><span class="line">    __init__(self):</span><br><span class="line">        new_socket</span><br><span class="line">Class B(A):</span><br><span class="line">    __init__(self):</span><br><span class="line">        supter.__init__(self)</span><br><span class="line">Class C(A):</span><br><span class="line">    __init__(self):</span><br><span class="line">        super.__init__(self)</span><br><span class="line">Class D(B, C):</span><br><span class="line">    __init__(self):</span><br><span class="line">        super().__init__(self)</span><br><span class="line"><span class="comment"># 其中print(D.__mro__)=(D, B, C, A, object)</span></span><br><span class="line"><span class="comment"># 那么如果从D开始，如果父类都有调用super，则会根据mro中的顺序调用，即D、B、C、A</span></span><br></pre></td></tr></table></figure></li>
<li><code>super(ClassName, self)</code>，会从ClassName往后开始调用，如<code>super(B, self)</code>则顺序是B、C、A。默认从当前类开始</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<h4 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数"></a>可变参数</h4><ul>
<li><code>func(a, *args, **kwargs)</code><ul>
<li>一个<code>*</code>号以元祖的形式传递参数，变量名是args，<code>*</code>号只是告诉编译器</li>
<li>两个<code>*</code>号以字典的形式传递参数，变量名是kwargs<ul>
<li><strong>接收关键字参数</strong> ：如<code>func(1, 2, 3, 4, age=&#39;12&#39;, name=&#39;ring&#39;)</code><ul>
<li>args=(2, 3, 4)</li>
<li>kwargs={‘age’: ‘12’, ‘name’: ‘ring’}</li>
</ul>
</li>
<li>需要注意的是如果传的是一个字典，它并不是关键字参数，而是一个字典(一个整体)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="静态方法和属性方法"><a href="#静态方法和属性方法" class="headerlink" title="静态方法和属性方法"></a>静态方法和属性方法</h4><ul>
<li>类对象和实例对象<ul>
<li>创建一个对象会从模板类中调用<code>__new__</code>分配内存空间，<code>__init__</code>初始化内存空间，<code>__class__</code>指向创建这个实例对象的类对象</li>
<li>对于公有的方法、属性存储在类对象中<ul>
<li>如方法<code>__inti__(self)</code>就不必每个实例都有一份，放在类对象中即可</li>
</ul>
</li>
<li>对于特有的方法、属性存储在类对象中<ul>
<li>如初始化name=ring，那么对于这个实例的name是ring，别的实例有所区别</li>
</ul>
</li>
</ul>
</li>
<li>类方法、实例方法、静态方法<ul>
<li>实例方法：一般的方法<ul>
<li>很难修改类属性，若<code>obj.class_state=&quot;xx&quot;</code>原来<code>class_state</code>是一个类属性。这个方法将导致实例里面新增一个名为<code>class_state</code>的属性<ul>
<li>要修改也是可以的<code>obj.__class__.class_state=&quot;xx&quot;</code>就可以修改<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">        <span class="comment"># 实例方法</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span>  <span class="comment"># 默认传实例对象的引用self</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    ```  </span><br><span class="line">* 类方式：用`@classmethod`装饰</span><br><span class="line">    ``` python</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"><span class="meta">        @classmethod  # 类方法</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(cls)</span>:</span>  <span class="comment"># python解释器默认把类对象引用cls传入</span></span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>可以修改类属性</li>
</ul>
</li>
<li>静态方法：用<code>@staticmethod</code>装饰<ul>
<li>相当于在类外定义一个函数， <strong>不让python解释权默认传入类对象或实例对象</strong> 。写在类中是为例在不同类中区分开来</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="property属性"><a href="#property属性" class="headerlink" title="property属性"></a>property属性</h4><ul>
<li>用装饰器创建<ul>
<li>让代码更简洁，调用一个函数像取值、赋值一样</li>
<li>在普通方法前用<code>@property</code>修饰，如。把调用方法改成”调用属性”，但实际还是调用方法，只是可读性更高  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">     </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>  <span class="comment"># 必须返回一个值，且参数只有self</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">a.func  <span class="comment"># 可以通过a.func调用，而不用a.func()</span></span><br></pre></td></tr></table></figure></li>
<li>新式类(继承object，python3默认继承)中有3中property装饰器  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">     </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>   <span class="comment"># 获取值</span></span><br><span class="line">     </span><br><span class="line"><span class="meta">    @property.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self, value)</span>:</span>  <span class="comment"># 要同名，且传入新值value</span></span><br><span class="line">        print(<span class="string">"some"</span>)  <span class="comment"># 设置值</span></span><br><span class="line">    <span class="comment"># 如可以调用xxx.func = 100</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">    @property.deleter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"some"</span>)  <span class="comment"># 删除值</span></span><br><span class="line">    <span class="comment"># 如可以调用del xxx.func</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>通过类属性创建<ul>
<li><code>property(arg1, arg2, arg3, arg4)</code><ul>
<li>参数1是方法名，调用<code>对象.属性</code>时自动触发执行</li>
<li>(可选)参数2是方法名，调用<code>对象.属性=xx</code>时自动触发执行</li>
<li>(可选)参数3是方法名，调用<code>del 对象.属性</code>时自动触发执行</li>
<li>(可选)参数4是字符串，调用<code>对象.属性.__doc__</code>时此参数是该属性的描述信息<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> </span><br><span class="line">    </span><br><span class="line">    FUNC = property(func)</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">a.FUNC</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="修改私有属性"><a href="#修改私有属性" class="headerlink" title="修改私有属性"></a>修改私有属性</h4><p>私有属性(在以<code>__</code>开头的变量)之所以无法访问是因为python悄悄改了变量名。如把<code>__func</code>改成了<code>_className__func</code>。所以使用这个改后的名就可以访问私有属性。这机制叫做名字重整。</p>
<h4 id="魔法属性-方法"><a href="#魔法属性-方法" class="headerlink" title="魔法属性/方法"></a>魔法属性/方法</h4><ul>
<li><code>__doc__</code>和<code>help()</code><ul>
<li>使用<code>var.__doc__</code>或<code>help(var)</code>可以查看写在开头的描述</li>
</ul>
</li>
<li><code>__module__</code>和<code>__class__</code><ul>
<li><code>__class__</code>表示当前操作的对象的类是什么</li>
<li><code>__module__</code>表示当前操作的对象是在哪个模块</li>
</ul>
</li>
<li><code>__init__</code><ul>
<li><strong>初始化</strong> 方法，创建类对象时自动触发执行</li>
</ul>
</li>
<li><code>__del__</code><ul>
<li>对象释放时，自动触发执行</li>
</ul>
</li>
<li><code>__call__</code><ul>
<li>对象后面加括号，触发执行<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">obj = classA()</span><br><span class="line">obj()   <span class="comment"># obj.__call__()</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>__dict__</code><ul>
<li>类或对象的所有属性</li>
</ul>
</li>
<li><code>__str__</code><ul>
<li>如果一个类中定义了<code>__str__</code>方法，那么打印对象时，默认输出改方法的返回值</li>
</ul>
</li>
<li><code>__getitem__</code>、<code>__setitem__</code>、<code>__delitem</code><ul>
<li>如果类中实现了这3个方法，则可以当字典用<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(key)</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(key)</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(key)</span><br><span class="line"></span><br><span class="line">odj = A()</span><br><span class="line">res = obj[<span class="string">'k1'</span>]   <span class="comment"># __getitem__</span></span><br><span class="line">obj[<span class="string">'k2'</span>] = <span class="string">'abc'</span> <span class="comment"># __setitem__</span></span><br><span class="line"><span class="keyword">del</span> obj[<span class="string">'k3'</span>]     <span class="comment"># __delitem__</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>__getslice__</code>、<code>__setslice__</code>、<code>__delslice__</code><ul>
<li>如果类中实现了这3个方法，则可以用于分片操作，如列表<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setslice__</span><span class="params">(self, i, j)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, i, j)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delslice__</span><span class="params">(self, i, j)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">odj = A()</span><br><span class="line">obj[<span class="number">-1</span>:<span class="number">1</span>]            <span class="comment"># __getslice__</span></span><br><span class="line">obj[<span class="number">0</span>:<span class="number">1</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="comment"># __setslice__</span></span><br><span class="line"><span class="keyword">del</span> obj[<span class="number">0</span>:<span class="number">2</span>]         <span class="comment"># __delslice__</span></span><br></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ul>
<h4 id="with与上下文管理器"><a href="#with与上下文管理器" class="headerlink" title="with与上下文管理器"></a>with与上下文管理器</h4><p>使用with打开文件能够保证最终文件都会关闭。如果采用传统的<code>f = open()</code>则需要try-catch辅助。with是一种更简洁的写法。</p>
<ul>
<li>上下文管理器<ul>
<li>任何实现了<code>__enter__()</code>和<code>__exit__()</code>方法的对象都可称之为上下文管理器。</li>
<li><code>__enter__()</code>返回资源对象</li>
<li><code>__exit__()</code>处理一些清理工作</li>
</ul>
</li>
</ul>
<p>当一个对象实现了上下文管理器，就可以使用with语句了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> obj(args) <span class="keyword">as</span> f:  </span><br><span class="line">    <span class="comment"># obj()创建实例对象</span></span><br><span class="line">    <span class="comment"># with自动调用了obj(上下文管理器)的__enter__方法，enter的返回值赋给f</span></span><br><span class="line">    <span class="comment"># 如果产生了异常，将自动调用__exit__方法</span></span><br></pre></td></tr></table></figure>


<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>多层函数嵌套、往往内部函数用到外部函数的变量，一个特殊的对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solve</span><span class="params">(x)</span>:</span></span><br><span class="line">        print(a*x + b)</span><br><span class="line">    <span class="keyword">return</span> solve</span><br><span class="line"></span><br><span class="line">ans = func(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># 创造单独空间，包含参数a, b和solve函数。a, b相当于solve的全局变量</span></span><br><span class="line"><span class="comment"># 类似类，但比类开销小</span></span><br><span class="line">ans(<span class="number">0</span>)</span><br><span class="line">ans(<span class="number">1</span>)</span><br><span class="line">ans(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>


<h4 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    x = <span class="number">100</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solve</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> x  <span class="comment"># 告诉解释器x不是solve中的，否则由于x=10的存在。会导致解释器认为x这个局部变量在声明前使用</span></span><br><span class="line">        print(x)</span><br><span class="line">        x = <span class="number">10</span>  </span><br><span class="line">        print(x)</span><br><span class="line">    <span class="keyword">return</span> solve</span><br></pre></td></tr></table></figure>


<h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><p>有时候我们需要进行一下重复的过程, 比如计算函数用时. 如果我们直接把逻辑写在函数内部, 逻辑混乱且可读性不高。这时我们就可以使用装饰器</p>
<h4 id="装饰器的基本实现过程"><a href="#装饰器的基本实现过程" class="headerlink" title="装饰器的基本实现过程"></a>装饰器的基本实现过程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_func</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call_func</span><span class="params">()</span>:</span></span><br><span class="line">        func()</span><br><span class="line">    <span class="keyword">return</span> call_func</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">test = set_func(test)</span><br><span class="line">test()</span><br><span class="line"></span><br><span class="line"><span class="comment">### 等价于</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@set_func  # 等价于test=set_func(test)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>


<h4 id="有参数的装饰器实现过程"><a href="#有参数的装饰器实现过程" class="headerlink" title="有参数的装饰器实现过程"></a>有参数的装饰器实现过程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_func</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call_func</span><span class="params">(a)</span>:</span>  <span class="comment"># 参数100会传到这</span></span><br><span class="line">        func(a)</span><br><span class="line">    <span class="keyword">return</span> call_func</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">test = set_func(test)</span><br><span class="line">test(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>


<h4 id="不定参数的装饰器实现过程"><a href="#不定参数的装饰器实现过程" class="headerlink" title="不定参数的装饰器实现过程"></a>不定参数的装饰器实现过程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_func</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call_func</span><span class="params">(*args, **kwargs)</span>:</span>  <span class="comment"># 参数会传到这，这里的星号是告诉解释器</span></span><br><span class="line"></span><br><span class="line">        func(*args, **kwargs)  <span class="comment"># 这里的星号是拆包!!!，否则就是一个列表、一个字典</span></span><br><span class="line">    <span class="keyword">return</span> call_func</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(age, num, *args, &amp;&amp;kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">test = set_func(test)</span><br><span class="line">test(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>


<h4 id="带有返回值的装饰器实现"><a href="#带有返回值的装饰器实现" class="headerlink" title="带有返回值的装饰器实现"></a>带有返回值的装饰器实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_func</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call_func</span><span class="params">(*args, **kwargs)</span>:</span> </span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)  <span class="comment"># 比包里调用，返回出去</span></span><br><span class="line">    <span class="keyword">return</span> call_func</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(age, num, *args, &amp;&amp;kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">test = set_func(test)</span><br><span class="line">test(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>


<h4 id="给装饰器的参数"><a href="#给装饰器的参数" class="headerlink" title="给装饰器的参数"></a>给装饰器的参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">option</span><span class="params">(args)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_func</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">call_func</span><span class="params">(*args, **kwargs)</span>:</span> </span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> call_func</span><br><span class="line">    <span class="keyword">return</span> set_func</span><br><span class="line"></span><br><span class="line"><span class="meta">@option(args)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(age, num, *args, &amp;&amp;kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>装饰器需要一个函数指针，即@后跟函数名，由于option(args)不符合，所以先向下执行option(args)，返回的函数指针。@心满意足，用来装饰test函数</p>
<h4 id="多个装饰器对同一个函数进行装饰"><a href="#多个装饰器对同一个函数进行装饰" class="headerlink" title="多个装饰器对同一个函数进行装饰"></a>多个装饰器对同一个函数进行装饰</h4><p>先装下面的后装上面的。理解上面的实现过程。</p>
<p>执行效果是先执行上面的再执行下面的。所以装饰的顺序和想要的逻辑执行顺序相同即可。</p>
<h4 id="使用类当作装饰器"><a href="#使用类当作装饰器" class="headerlink" title="使用类当作装饰器"></a>使用类当作装饰器</h4><p>原理同闭包。只是变量名指向的不是函数，而是实例对象。</p>
<p>然后使用<code>变量名()</code>调用的是<code>实例对象.__call__()</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func)</span>:</span></span><br><span class="line">        self.func = func</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.func()</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/26/universe/how_to_makefile/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/26/universe/how_to_makefile/" class="post-title-link" itemprop="url">How to makefile</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-26 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-26T00:00:00+08:00">2020-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-07-12 16:38:47" itemprop="dateModified" datetime="2020-07-12T16:38:47+08:00">2020-07-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="How-to-makefile"><a href="#How-to-makefile" class="headerlink" title="How to makefile"></a>How to makefile</h1><h2 id="Compile-process"><a href="#Compile-process" class="headerlink" title="Compile process"></a>Compile process</h2><p>How dose a project turn into an excutable file? There are four step:</p>
<ul>
<li>Preprocessing<ul>
<li>Unfold all include libs, macro, head. And produce <code>.i</code> file.</li>
<li>(gcc/g++ commands)<code>-E</code></li>
</ul>
</li>
<li>Compilation<ul>
<li>The <code>.i</code> file produce an <code>.s</code> file(assembly code).</li>
<li><code>-S</code></li>
</ul>
</li>
<li>Assemble<ul>
<li>The <code>.s</code> file produce an <code>.o</code> file(object file).It is a binary file.</li>
<li><code>-c</code></li>
</ul>
</li>
<li>Linking<ul>
<li>Linking the <code>.o</code> file produce an excutable file.</li>
</ul>
</li>
</ul>
<p>Whole example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -E halo.c -o halo.i  </span><br><span class="line">gcc -S halo.i -o halo.s  </span><br><span class="line">gcc -c halo.s -o halo.o  </span><br><span class="line">gcc -o halo.o -o halo</span><br></pre></td></tr></table></figure>

<h2 id="Why-makefile"><a href="#Why-makefile" class="headerlink" title="Why makefile"></a>Why makefile</h2><p>As we see, compile a file include so much process.Though <code>gcc halo.c -o halo</code> can do the same thing as above, you need to make sure all the <code>.c</code> file are in the directory.<br>And what if a thousand file to compile?</p>
<h2 id="Lets-start"><a href="#Lets-start" class="headerlink" title="Lets start"></a>Lets start</h2><h3 id="Format"><a href="#Format" class="headerlink" title="Format"></a>Format</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">target: dependencies</span></span><br><span class="line">    command</span><br><span class="line"></span><br><span class="line">^ before command IS A TAB, and make sure a new line at the end</span><br></pre></td></tr></table></figure>
<p>We should write “from rear to front”. Which means write final target command first and then write dependencies commandS</p>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make target...</span><br></pre></td></tr></table></figure>

<p>If didn’t specify target, run the first target as default. That is why should we wirte main object at first.</p>
<h1 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a>CMake</h1><p>Makefile may not work at different platform. Is quite annoying to rebuild a Makefile. So CMake is came.</p>
<p>CMake can auto generate Makefile, it is more cross-platform.</p>
<p>Usually, cmake command write in a <code>CMakeLists.txt</code> file.</p>
<h2 id="Some-basic"><a href="#Some-basic" class="headerlink" title="Some basic"></a>Some basic</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CMAKE_MINIMUM_REQUIRED(VERSION define_a_minimum_version_here)</span><br><span class="line"></span><br><span class="line">PROJECT(define_project_name)</span><br><span class="line"></span><br><span class="line">AUX_SOURCE_DIRECTORY(&#x2F;your&#x2F;dir&#x2F;source pkg_name)  # to packaging files in dir_source. So you do not need every single source file below.</span><br><span class="line"></span><br><span class="line">ADD_EXECUTABLE(executalbe_name source_files...)</span><br><span class="line"># or</span><br><span class="line">ADD_EXECUTABLE(executalbe_name $&#123;pkg_name&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Multi-Dir-CMake"><a href="#Multi-Dir-CMake" class="headerlink" title="Multi Dir CMake"></a>Multi Dir CMake</h2><p>Every sub dir need a CMake file. So your main CMake file can use it.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AUX_SOURCE_DIRECTORY(&#x2F;your&#x2F;dir&#x2F;source pkg_name)</span><br><span class="line"></span><br><span class="line"># static library</span><br><span class="line">ADD_LIBRARY(lib_name STATIC $&#123;pkg_name&#125;)  </span><br><span class="line"></span><br><span class="line"># dynamic library</span><br><span class="line">ADD_LIBRARY(lib_name SHARED $&#123;pkg_name&#125;)</span><br></pre></td></tr></table></figure>

<p>Use sub dir</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CMAKE_MINIMUM_REQUIRED(VERSION minimum_version)</span><br><span class="line"></span><br><span class="line">PROJECT(project_name)</span><br><span class="line"></span><br><span class="line">ADD_SUBDIRACTORY(.&#x2F;subdir)  # add subdir</span><br><span class="line"></span><br><span class="line">AUX_SOURCE_DIRECTORY(&#x2F;your&#x2F;dir&#x2F;source pkg_name)</span><br><span class="line"></span><br><span class="line">ADD_EXECUTABLE(executalbe_name $&#123;pkg_name&#125;)</span><br><span class="line"></span><br><span class="line">TARGET_LINKLIBRARYS(executalbe_name SubLib)  # link sub lib</span><br></pre></td></tr></table></figure>


<h2 id="Standard-Project"><a href="#Standard-Project" class="headerlink" title="Standard Project"></a>Standard Project</h2><p>📁/Project<br>—📁/build<br>—📁/src<br>—📁/lib<br>—📝/CMakeLists.txt</p>
<ul>
<li><p><code>./src/CMakeLists.txt</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INCLUDE_DIRECTORY(.&#x2F;path&#x2F;to&#x2F;lib)  #INCLUDE_DIRECTORY(.&#x2F;lib)</span><br><span class="line"></span><br><span class="line">SET(EXECUTABLE_OUTPUT_PATH $(PROJECT_BINARARY_DIR)&#x2F;bin)</span><br><span class="line"># set executable output to EXECUTABLE_OUTPUT_PATH&#x2F;bin &#x3D;..&#x2F;build&#x2F;bin</span><br><span class="line"></span><br><span class="line">AUX_SOURCE_DIRECTORY(&#x2F;your&#x2F;dir&#x2F;source pkg_name)</span><br><span class="line"></span><br><span class="line">ADD_EXECUTABLE(executalbe_name $&#123;pkg_name&#125;)</span><br><span class="line"></span><br><span class="line">TARGET_LINKLIBRARYS(executalbe_name SubLib)  # link sub lib</span><br></pre></td></tr></table></figure></li>
<li><p><code>./lib/CMakeLists.txt</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">AUX_SOURCE_DIRECTORY(&#x2F;your&#x2F;dir&#x2F;source pkg_name)</span><br><span class="line"></span><br><span class="line">SET(LIBRARAY_OUTPUT_PATH $(PROJECT_BINARARY_DIR)&#x2F;lib)</span><br><span class="line"># set library output to PROJECT_BINARARY_DIR&#x2F;lib&#x3D;..&#x2F;build&#x2F;lib</span><br><span class="line"></span><br><span class="line"># static library</span><br><span class="line">ADD_LIBRARY(lib_name STATIC $&#123;pkg_name&#125;)  </span><br><span class="line"></span><br><span class="line"># dynamic library</span><br><span class="line">ADD_LIBRARY(lib_name SHARED $&#123;pkg_name&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p><code>./CMakeLists.txt</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CMAKE_MINIMUM_REQUIRED(VERSION minimum_version)</span><br><span class="line"></span><br><span class="line">PROJECT(project_name)</span><br><span class="line"></span><br><span class="line">ADD_SUBDIRACTORY(.&#x2F;subdir)  # add subdir</span><br><span class="line"></span><br><span class="line">ADD_SUBDIRACTORY(.&#x2F;src)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ccmake(config cmake)</p>
</li>
<li><p>some other option</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/26/universe/vim/vim_in_action/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/26/universe/vim/vim_in_action/" class="post-title-link" itemprop="url">vim实用技巧</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-26 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-26T00:00:00+08:00">2020-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-29 19:56:23" itemprop="dateModified" datetime="2020-09-29T19:56:23+08:00">2020-09-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Vim实用技巧"><a href="#Vim实用技巧" class="headerlink" title="Vim实用技巧"></a>Vim实用技巧</h1><h2 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h2><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>o</td>
<td>切换高亮中光标所在的端点</td>
</tr>
<tr>
<td>.</td>
<td>重复执行上一步操作</td>
</tr>
<tr>
<td>%</td>
<td>它代表当前文件中的所有行</td>
</tr>
<tr>
<td>%</td>
<td>可以在一组开, 闭括号间跳转</td>
</tr>
<tr>
<td>m{mark}</td>
<td>当前位置标记为{mark}以便以后跳转</td>
</tr>
<tr>
<td>`{mark}</td>
<td>跳到{mark}标记处</td>
</tr>
<tr>
<td>qa</td>
<td>录制宏到寄存器a</td>
</tr>
<tr>
<td>qA</td>
<td>往寄存器a中追加操作</td>
</tr>
<tr>
<td>i/d{</td>
<td>i for inside, a for around, 就可以用di/da等操作</td>
</tr>
<tr>
<td>=i{</td>
<td>=格式化?(缩进), inside {}</td>
</tr>
<tr>
<td>:earlier/later 1m</td>
<td>回到1min前/后</td>
</tr>
<tr>
<td>c-z</td>
<td>挂起vim,命令行下:$ fg可以恢复,jobs查看挂起的进程</td>
</tr>
<tr>
<td>c-a/c-x</td>
<td>数字加/减1</td>
</tr>
<tr>
<td>{}</td>
<td>跳转到上一个/下一个段落</td>
</tr>
<tr>
<td>q:, q/, q?</td>
<td>打开命令历史</td>
</tr>
<tr>
<td>gv</td>
<td>选择上一次的选择</td>
</tr>
<tr>
<td>g <c-a>/<c-v></td>
<td>visual mode下</td>
</tr>
<tr>
<td>:g/regex/ex</td>
<td>run the Ex command only on teh line that match</td>
</tr>
<tr>
<td>:v/regex/ex</td>
<td>run the Ex command only on teh line not match</td>
</tr>
<tr>
<td>:windo {ex}</td>
<td>run ex on all windows</td>
</tr>
</tbody></table>
<h2 id="状态保存"><a href="#状态保存" class="headerlink" title="状态保存"></a>状态保存</h2><table>
<thead>
<tr>
<th>command</th>
<th>action</th>
</tr>
</thead>
<tbody><tr>
<td>:mkview</td>
<td>保留当前buffer的一些状态，如fold状态，小而精</td>
</tr>
<tr>
<td>:loadview</td>
<td>恢复当前buffer，mkview保留的状态</td>
</tr>
<tr>
<td>:mksession</td>
<td>保留当前vim状态成.vim文件，包括所有的window等，大而全。由于是.vim，可以通过source恢复</td>
</tr>
</tbody></table>
<h2 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h2><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>向下查找光标停靠的词语</td>
</tr>
<tr>
<td>#</td>
<td>向上查找</td>
</tr>
<tr>
<td>;</td>
<td>重复上一次查找</td>
</tr>
<tr>
<td>,</td>
<td>反转方向重复上一次查找</td>
</tr>
<tr>
<td>\ze和\ze</td>
<td>匹配界定符, 匹配边界</td>
</tr>
</tbody></table>
<h3 id="按正则表达式查找"><a href="#按正则表达式查找" class="headerlink" title="按正则表达式查找"></a>按正则表达式查找</h3><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>\v</td>
<td>使用正则的特殊符号规则</td>
</tr>
<tr>
<td>\V</td>
<td>原意查找, 即.啊什么的不用反斜转意</td>
</tr>
<tr>
<td>\w</td>
<td>用来匹配单词类字符, 包括字母,数字及符号</td>
</tr>
<tr>
<td>\W</td>
<td>匹配单词类以外的所有字符</td>
</tr>
<tr>
<td>\{num}</td>
<td>引用被没对()捕获的子匹配 \0会引用整个匹配</td>
</tr>
<tr>
<td>&lt;和&gt;</td>
<td>\v模式中&lt;和&gt;用来匹配边界</td>
</tr>
</tbody></table>
<h2 id="操作符-动作-操作"><a href="#操作符-动作-操作" class="headerlink" title="操作符 + 动作 = 操作"></a>操作符 + 动作 = 操作</h2><h3 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h3><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>c</td>
<td>修改</td>
</tr>
<tr>
<td>d</td>
<td>删除</td>
</tr>
<tr>
<td>y</td>
<td>复制到寄存器</td>
</tr>
<tr>
<td>g~</td>
<td>反转大小写</td>
</tr>
<tr>
<td>gu</td>
<td>反转为小写</td>
</tr>
<tr>
<td>gU</td>
<td>反转为大写</td>
</tr>
<tr>
<td>&gt;</td>
<td>增加缩进</td>
</tr>
<tr>
<td>&lt;</td>
<td>减小缩进</td>
</tr>
<tr>
<td>=</td>
<td>自动缩进</td>
</tr>
<tr>
<td>!</td>
<td>使用外部程序</td>
</tr>
</tbody></table>
<h3 id="动作"><a href="#动作" class="headerlink" title="动作"></a>动作</h3><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>w</td>
<td>向后一个单词</td>
</tr>
<tr>
<td>W</td>
<td>当前字串</td>
</tr>
<tr>
<td>aw</td>
<td>a word, 光标停靠的整个单词及一个空格</td>
</tr>
<tr>
<td>ab</td>
<td>一对圆括号</td>
</tr>
<tr>
<td>aB</td>
<td>一对花括号</td>
</tr>
<tr>
<td>t</td>
<td>to 到</td>
</tr>
<tr>
<td>i”</td>
<td>inside 在””中</td>
</tr>
<tr>
<td>it</td>
<td>inside tag <h1></h1></td>
</tr>
<tr>
<td>p</td>
<td>段落</td>
</tr>
<tr>
<td>s</td>
<td>句子</td>
</tr>
<tr>
<td>@a</td>
<td>宏a</td>
</tr>
</tbody></table>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>caw</td>
<td>修改当期单词</td>
</tr>
<tr>
<td>dta</td>
<td>删除当前位置到字母啊</td>
</tr>
<tr>
<td>以此类推</td>
<td></td>
</tr>
</tbody></table>
<h2 id="Ctrl-x补全"><a href="#Ctrl-x补全" class="headerlink" title="Ctrl+x补全"></a>Ctrl+x补全</h2><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>c-x,c-r</td>
<td>insert from a register</td>
</tr>
<tr>
<td>c-x,c-a</td>
<td>last inserted text</td>
</tr>
<tr>
<td>c-x,c-]</td>
<td>tag completion</td>
</tr>
<tr>
<td>c-x,c-f</td>
<td>filename completion</td>
</tr>
<tr>
<td>c-x,c-p/c-n</td>
<td>context-aware word completion</td>
</tr>
<tr>
<td>c-x,l</td>
<td>context-aware line completion</td>
</tr>
</tbody></table>
<h2 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h2><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>“{register}</td>
<td>制定寄存器{register}</td>
</tr>
<tr>
<td>“”</td>
<td>无名寄存器, 没指定寄存器情况下缺省使用</td>
</tr>
<tr>
<td>“0</td>
<td>复制专用寄存器</td>
</tr>
<tr>
<td>“_</td>
<td>黑洞寄存器, 有去无回</td>
</tr>
<tr>
<td>“+</td>
<td>X11剪贴板</td>
</tr>
<tr>
<td>&lt;C-r&gt;{register}</td>
<td>在在插入模式下插入寄存器内容</td>
</tr>
<tr>
<td>:reg a</td>
<td>查看寄存器a</td>
</tr>
<tr>
<td>等等</td>
<td></td>
</tr>
</tbody></table>
<h2 id="Shell命令"><a href="#Shell命令" class="headerlink" title="Shell命令"></a>Shell命令</h2><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>%</td>
<td>命令行中的%会展开成当前文件的完整路径</td>
</tr>
<tr>
<td>:shell</td>
<td>启动一个shell(输入exit返回vim)</td>
</tr>
<tr>
<td>:!{cmd}</td>
<td>在shell中执行{cmd}</td>
</tr>
<tr>
<td>:read !{cmd}</td>
<td>把{cmd}的标准输出插入到光标下方</td>
</tr>
<tr>
<td>:[range]write !{cmd}</td>
<td>以[range]作为{cmd}的标准输入</td>
</tr>
</tbody></table>
<h2 id="分屏操作"><a href="#分屏操作" class="headerlink" title="分屏操作"></a>分屏操作</h2><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>&lt;C-w&gt;=</td>
<td>使得所有窗口等宽, 登高</td>
</tr>
<tr>
<td>&lt;C-w&gt;_</td>
<td>最大化活动窗口的高度</td>
</tr>
<tr>
<td>&lt;C-w&gt;|</td>
<td>最大化活动窗口的宽度</td>
</tr>
<tr>
<td>&lt;C-w&gt;方向</td>
<td>移动光标所在的窗口</td>
</tr>
</tbody></table>
<h2 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h2><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>虚拟行, 位于第一行上方</td>
</tr>
<tr>
<td>1</td>
<td>文件第一行</td>
</tr>
<tr>
<td>$</td>
<td>最后一行</td>
</tr>
<tr>
<td>.</td>
<td>光标所在行</td>
</tr>
<tr>
<td>‘m</td>
<td>包含位置标记m的行</td>
</tr>
<tr>
<td>‘&lt;</td>
<td>高亮选取的起始行</td>
</tr>
<tr>
<td>‘&gt;</td>
<td>高亮选取的结束行</td>
</tr>
<tr>
<td>%</td>
<td>整个文件</td>
</tr>
</tbody></table>
<h2 id="宏"><a href="#宏" class="headerlink" title="宏"></a>宏</h2><p>录制宏其实是把操作过程放入了一个寄存器中，如<code>qq</code>就是用寄存器q来录制宏。用<code>:reg q</code>可以查看内容。</p>
<ul>
<li><code>qq</code>：用寄存器q录制宏</li>
<li><code>qQ</code>:往寄存器q中追加操作</li>
<li><code>:put q</code>：把寄存器q的内容粘贴到文档，以便修改<ul>
<li>Or <code>[&quot;x]p</code></li>
</ul>
</li>
<li><code>:d q</code>：复制回寄存器<ul>
<li><code>[&quot;x]d{motion}</code> delete text move over [into register x], like<code>&quot;qd3d</code>删除三行，到寄存器q中</li>
</ul>
</li>
</ul>
<h2 id="目录操作"><a href="#目录操作" class="headerlink" title="目录操作"></a>目录操作</h2><h3 id="利用-进行文件操作"><a href="#利用-进行文件操作" class="headerlink" title="利用%进行文件操作"></a>利用%进行文件操作</h3><p>只读寄存器%中储存有当前文件路径，通过关键字可以展开到绝对路径、所在目录等信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:echo expand(&#39;%:t&#39;)  &quot; 文件名</span><br><span class="line">:echo expand(&#39;%:p&#39;)  &quot; 绝对路径</span><br><span class="line">:echo expand(&#39;%:p:h&#39;) &quot; 所在目录</span><br><span class="line">:echo expand(&#39;%:p:h:t&#39;) &quot; 所在目录名</span><br></pre></td></tr></table></figure>

<p> <strong>p表示path，h表示head，t表示tail</strong> </p>
<h3 id="打开目录"><a href="#打开目录" class="headerlink" title="打开目录"></a>打开目录</h3><p>如果打开的是目录，则Vim会使用<code>Explore</code>打开。当然也可手动在一个文件中<code>:Explore</code>打开当前目录。</p>
<ul>
<li><code>:Sexplore</code>，水平分割打开目录</li>
<li><code>:Vexplore</code>，垂直分割打开目录</li>
</ul>
<h1 id="Vim-Doc-File"><a href="#Vim-Doc-File" class="headerlink" title="Vim Doc File"></a>Vim Doc File</h1><h2 id="Insert模式下的快速操作"><a href="#Insert模式下的快速操作" class="headerlink" title="Insert模式下的快速操作"></a>Insert模式下的快速操作</h2><ul>
<li>修正操作<ul>
<li><code>&lt;c-w&gt;</code>，向后删除一个词</li>
<li><code>&lt;c-u&gt;</code>，删除整行</li>
</ul>
</li>
<li>从寄存器插入<ul>
<li><code>&lt;c-r&gt;{reg}</code></li>
<li><code>&lt;c-r&gt;&lt;c-r&gt;{reg}</code>，不翻译特殊字符，如回车、退格等</li>
</ul>
</li>
<li>插入Digraphs<ul>
<li><code>&lt;c-k&gt;{key}</code>，插入一个digraphs，如®等键盘没有的字符，具体key看<code>:digraphs</code></li>
</ul>
</li>
<li>重复操作<ul>
<li><code>&lt;c-a&gt;</code>，输入你上次在Insert模式下的输入</li>
<li><code>&lt;c-@&gt;</code>，输入你上次在Insert模式下的输入，然后退出Insert模式</li>
<li><code>&lt;c-y&gt;</code>，插入鼠标上方的字符</li>
</ul>
</li>
<li>快速执行普通模式<ul>
<li><code>&lt;c-o&gt;{cmd}</code></li>
</ul>
</li>
<li><strong>Omni Completion</strong><ul>
<li>building, see <code>compl-omni-filetype</code> and <code>ft-c-omni</code></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/25/universe/GDB_Usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/25/universe/GDB_Usage/" class="post-title-link" itemprop="url">GDB usage</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-25 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-25T00:00:00+08:00">2020-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-17 14:23:22" itemprop="dateModified" datetime="2020-06-17T14:23:22+08:00">2020-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h1><ul>
<li>Make sure compile file with <code>-g</code> option, which mean turn on debugging with gdb<ul>
<li>like this: <code>gcc -g main.cpp -o main</code></li>
</ul>
</li>
</ul>
<h2 id="Debugging-with-GDB"><a href="#Debugging-with-GDB" class="headerlink" title="Debugging with GDB"></a>Debugging with GDB</h2><ul>
<li>open file<ul>
<li>here are two way</li>
<li><code>gdb filename</code><ul>
<li><code>gdb path/to/main</code></li>
</ul>
</li>
<li><code>gdb</code> -&gt; <code>file path/to/main</code></li>
</ul>
</li>
<li>show list<ul>
<li>use <code>l</code> command to show source code with line number</li>
</ul>
</li>
<li>add breakpoint<ul>
<li>use <code>b linenum</code> to add breakpoint, such as <code>b 1</code> add breakpoint at line 1</li>
<li>or use <code>b functionname</code> to add breakpoint, such as <code>b main</code> add breakpoint at main function</li>
</ul>
</li>
<li>show breakpoint information<ul>
<li><code>i b</code> i for information, b for breakpoint</li>
</ul>
</li>
<li>delete breakpoint<ul>
<li><code>d pointid</code> pointid from <code>i b</code></li>
<li><code>i b</code> information will be like a order list. If delete a pointid in the previous, the next point will just add in the end of the idlist.</li>
</ul>
</li>
<li>run debug<ul>
<li><code>r</code></li>
<li>use <code>p variable</code> will show the variable information</li>
</ul>
</li>
<li>gdb controler<ul>
<li><code>n</code> for next line, one step debugging</li>
<li><code>s</code> for step into(one step)</li>
<li><code>set args [parameter]</code> for command line args</li>
</ul>
</li>
<li>finish function and continue<ul>
<li><code>finish</code> for finish function</li>
<li><code>c</code> for continue until program exit or breakpoint</li>
</ul>
</li>
<li>quit gdb<ul>
<li><code>q</code></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/25/universe/linux/linux_philosophy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/25/universe/linux/linux_philosophy/" class="post-title-link" itemprop="url">Linux哲学记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-25 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-25T00:00:00+08:00">2020-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-20 17:10:26" itemprop="dateModified" datetime="2020-08-20T17:10:26+08:00">2020-08-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="开发效率问题"><a href="#开发效率问题" class="headerlink" title="开发效率问题"></a>开发效率问题</h4><p><strong>闭源</strong> </p>
<p>在一个项目开发中<br>假设一个人开发效率是100%, 因为他能全身心投入项目中. 两个人每个人的开发效率是80%, 其中20%是因为另一个人损耗的沟通成本, 那么两个人的效率就像一个人的160%.<br>但是如果人数增加, 每个人的沟通成本也会增加, 最后发现效率降低. 所以一个多人开发的大型项目理论上是不可能成功的.</p>
<p>那么框架, 框架的扩展性就显得尤其重要.</p>
<p><strong>开源</strong></p>
<p>一个开源项目往往有成百上千的人参与, 那根据上面的理论, 一个开源项目就不会成功.<br>但是当人数多到一定程度的时候, 一个潜在的错误一旦出现就会立刻得到解决, 反而大大提高了效率.<br>但是当人数多到一定程度的时候, 已经不在上面理论的范畴之内了, 就像物理世界的<strong>宏观和微观问题</strong>.<br>在多人开发的开源项目中的理论就遵循<em>linus</em> 提出的<strong>linus理论</strong>. 开源项目的成功就足以证明其正确性.</p>
<h4 id="开源程序的责任"><a href="#开源程序的责任" class="headerlink" title="开源程序的责任"></a>开源程序的责任</h4><p>一个开源程序往往有一个开源协议, 这些协议往往把责任只想广大社区的开发者, 也就是我们自己.<br>所以我们获取的开源软件我们自己, 我们广大开发者就要对其负责.</p>
<p>举个例子:比如你找学霸抄作业, 但是抄来的答案全是错是, 你该怪学霸吗?<br>于是你在抄之前, 问了一下别人是不是也抄了学霸的作业, 别人告诉你说没问题, 或者你检查了一遍发现没问题. 那社区就保证了它的安全性.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/23/universe/linux/linux_tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/23/universe/linux/linux_tips/" class="post-title-link" itemprop="url">linux command line</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-23 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-23T00:00:00+08:00">2020-02-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-24 16:39:11" itemprop="dateModified" datetime="2020-08-24T16:39:11+08:00">2020-08-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Command-line"><a href="#Command-line" class="headerlink" title="Command line"></a>Command line</h1><h2 id="Some-Ussful-tips"><a href="#Some-Ussful-tips" class="headerlink" title="Some Ussful tips"></a>Some Ussful tips</h2><ul>
<li><code>#</code> can delete a sub-string <strong>from the very beginning</strong> , like <code>var=apple; echo ${var#app}</code>, which will print <code>le</code>. <ul>
<li><code>#</code>, delete a few things as posible</li>
<li><code>##</code>, (greedy)delete a more things as posible</li>
<li><code>%</code>, use like <code>#</code>, but it delete from the end<ul>
<li><code>echo ${var%el}</code>, print app</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="shebang"><a href="#shebang" class="headerlink" title="shebang"></a>shebang</h2><p>a shebang is the interpreter of this script. like this</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br></pre></td></tr></table></figure>

<h2 id="Redirection"><a href="#Redirection" class="headerlink" title="Redirection"></a>Redirection</h2><table>
<thead>
<tr>
<th>command</th>
<th>function</th>
</tr>
</thead>
<tbody><tr>
<td>a &gt; b</td>
<td>a’s std output override into b</td>
</tr>
<tr>
<td>a &gt;&gt; b</td>
<td>a’s std output appand into b</td>
</tr>
<tr>
<td>a &lt; b</td>
<td>b as a’s input</td>
</tr>
<tr>
<td>a &lt;&lt; b</td>
<td>here document</td>
</tr>
<tr>
<td>a &lt;&lt;&lt; b</td>
<td>here</td>
</tr>
</tbody></table>
<h3 id="Here-document"><a href="#Here-document" class="headerlink" title="Here document"></a>Here document</h3><p>A block as input</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> &lt;&lt; token</span><br><span class="line">    text</span><br><span class="line">token</span><br><span class="line"></span><br><span class="line">example:</span><br><span class="line"><span class="built_in">echo</span> &lt;&lt; __EOF__</span><br><span class="line">halo</span><br><span class="line">__EOF__</span><br><span class="line"></span><br><span class="line">$ halo</span><br></pre></td></tr></table></figure>

<h3 id="Here"><a href="#Here" class="headerlink" title="Here"></a>Here</h3><p>a bit like <em>here document</em>, a line as input.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> ans1 ans2 ans3 &lt;&lt;&lt; <span class="string">"a1 a2 a3"</span></span><br><span class="line"></span><br><span class="line">a1 a2 a3 as input to <span class="built_in">read</span> process</span><br></pre></td></tr></table></figure>

<h2 id="Useful-commands"><a href="#Useful-commands" class="headerlink" title="Useful commands"></a>Useful commands</h2><h3 id="Grep"><a href="#Grep" class="headerlink" title="Grep"></a>Grep</h3><p><code>grep [option] file1 file2...</code>，support base regular expression，<code>egrep</code> or <code>grep -E</code> support extended Regex</p>
<p>The most commonly used<br>| options  | description                    |<br>|———-|——————————–|<br>| -i       | –ignore-case                  |<br>| -v       | –revert-mathch                |<br>| -c       | –count                        |<br>| -l       | –file-with-match              |<br>| -L       | –file-without-math            |<br>| -n       | –line-number                  |<br>| -h       | no filename in multi file mode |<br>| -a/-text | do not ignore binary data      |<br>| -e       | –regexp                       |<br>| -f       | specify regexp file            |</p>
<h3 id="Sed"><a href="#Sed" class="headerlink" title="Sed"></a>Sed</h3><p>sed can deal with text file with script-command or script-file.</p>
<p><code>sed [options][target-file]</code></p>
<table>
<thead>
<tr>
<th>options</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>-e</td>
<td></td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
</tbody></table>
<p>script action</p>
<table>
<thead>
<tr>
<th>action</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>a\</td>
<td>add a new line or lines next to current line</td>
</tr>
<tr>
<td>c\</td>
<td>replace current line with some text</td>
</tr>
<tr>
<td>d</td>
<td>delete line</td>
</tr>
<tr>
<td>i\</td>
<td>insert text befor curent line</td>
</tr>
<tr>
<td>h</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>H</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>g</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>G</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>I</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>p</td>
<td>print line</td>
</tr>
<tr>
<td>n</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>q</td>
<td>quit sed</td>
</tr>
<tr>
<td>r</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>!</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>s</td>
<td>replace string with other string</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
</tbody></table>
<p>replace identifier</p>
<table>
<thead>
<tr>
<th>options</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>g</td>
<td>global replace in this line</td>
</tr>
<tr>
<td>p</td>
<td>print line</td>
</tr>
<tr>
<td>w</td>
<td>write line into file</td>
</tr>
<tr>
<td>x</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>y</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
</tbody></table>
<h3 id="Cut"><a href="#Cut" class="headerlink" title="Cut"></a>Cut</h3><table>
<thead>
<tr>
<th>options</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
<tr>
<td>&lt;++&gt;</td>
<td>&lt;++&gt;</td>
</tr>
</tbody></table>
<h2 id="Regular-Expressions"><a href="#Regular-Expressions" class="headerlink" title="Regular Expressions"></a>Regular Expressions</h2><h3 id="Literals"><a href="#Literals" class="headerlink" title="Literals"></a>Literals</h3><table>
<thead>
<tr>
<th>pattern</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>match any char</td>
</tr>
<tr>
<td>char</td>
<td>literaly a char</td>
</tr>
</tbody></table>
<h3 id="Metacharacters"><a href="#Metacharacters" class="headerlink" title="Metacharacters"></a>Metacharacters</h3><h4 id="Anchors"><a href="#Anchors" class="headerlink" title="Anchors"></a>Anchors</h4><table>
<thead>
<tr>
<th>pattern</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>^</td>
<td>found at the begin of line</td>
</tr>
<tr>
<td>$</td>
<td>found at the end of line</td>
</tr>
</tbody></table>
<h4 id="Quantifiers"><a href="#Quantifiers" class="headerlink" title="Quantifiers"></a>Quantifiers</h4><table>
<thead>
<tr>
<th>pattern</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>?</td>
<td>match <strong>an element</strong> zero or one time</td>
</tr>
<tr>
<td>*</td>
<td>match <strong>an element</strong> zero or more times</td>
</tr>
<tr>
<td>+</td>
<td>match <strong>an element</strong> one or more times</td>
</tr>
<tr>
<td>{}</td>
<td>match <strong>an element</strong> a specific number of times</td>
</tr>
<tr>
<td>{n,}</td>
<td>match <strong>an element</strong> if it occurs n or more times</td>
</tr>
<tr>
<td>{,n}</td>
<td>match <strong>an element</strong> if it occurs no more than n times</td>
</tr>
</tbody></table>
<p>A quantifiers is after <strong>an element</strong>, such as <code>.*</code> means match any char with any lengh equivalent any string.</p>
<p>An element can like this <code>[A_Z]</code>and this<code>[:digit:]</code>. We can see the pattern before a quantifiers as a whole.</p>
<h4 id="Bracket-Expressions-and-Character-Classes"><a href="#Bracket-Expressions-and-Character-Classes" class="headerlink" title="Bracket Expressions and Character Classes"></a>Bracket Expressions and Character Classes</h4><ul>
<li><p>Bracket Expressions</p>
<ul>
<li>specify a set of characters to be match<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ grep -h <span class="string">'[bg]zip'</span> test.txt</span><br><span class="line">bzip2</span><br><span class="line">bzip123</span><br><span class="line">gzip</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Negation</p>
<ul>
<li>If the first char in a bracket expression is a caret(^), the <strong>remaining char</strong> are taken to be a set of chars that must not be present at the given char position.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ grep -h <span class="string">'[^bg]zip'</span> test.txt</span><br><span class="line">bunzip</span><br><span class="line">gunzip</span><br><span class="line">funzip</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Character Classes</p>
<ul>
<li>A set of characters range<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ grep -h <span class="string">'[^ABCDEF]'</span> test.txt</span><br><span class="line">or you can</span><br><span class="line">$ grep -h <span class="string">'[^A-F]'</span> test.txt</span><br><span class="line"></span><br><span class="line">Here are more expressions</span><br><span class="line">$ grep -h <span class="string">'[A-Fa-z0-9]'</span> test.txt</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>POSIX Character Class</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>char</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>[:alnum:]</td>
<td>alphanumeric characters.equivalent to[A-Za-z0-9]</td>
</tr>
<tr>
<td>[:word:]</td>
<td>same as alnum, with the addition of the underscore char(_)</td>
</tr>
<tr>
<td>[:alpha:]</td>
<td>[A-Za-z]</td>
</tr>
<tr>
<td>[:blank:]</td>
<td>space and tab char</td>
</tr>
<tr>
<td>[:digit:]</td>
<td>number 0 through 9</td>
</tr>
<tr>
<td>[:lower:]</td>
<td>the lowercase letters</td>
</tr>
<tr>
<td>[:upper:]</td>
<td>the uppercase letters</td>
</tr>
<tr>
<td>[:space:]</td>
<td>[\t\r\n\v\f]</td>
</tr>
<tr>
<td>[:xdigit:]</td>
<td>chars used to express hexadecimal numbers.[0-9a-fA-F]</td>
</tr>
</tbody></table>
<h2 id="Flow-control"><a href="#Flow-control" class="headerlink" title="Flow control"></a>Flow control</h2><h3 id="if-statements"><a href="#if-statements" class="headerlink" title="if statements"></a>if statements</h3><h4 id="File-Expressions"><a href="#File-Expressions" class="headerlink" title="File Expressions"></a>File Expressions</h4><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>f1 -ef f2</td>
<td>f1 and f2 have the same indoe number</td>
</tr>
<tr>
<td>f1 -nt f2</td>
<td>f1 newer than f2</td>
</tr>
<tr>
<td>f1 -ot f2</td>
<td>f1 older than f2</td>
</tr>
<tr>
<td>-d f1</td>
<td>f1 exists an is a directory</td>
</tr>
<tr>
<td>-e f1</td>
<td>f1 exists</td>
</tr>
<tr>
<td>-f f1</td>
<td>f1 is a regular file</td>
</tr>
</tbody></table>
<h4 id="String-Expressions"><a href="#String-Expressions" class="headerlink" title="String Expressions"></a>String Expressions</h4><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>string</td>
<td>string is not null</td>
</tr>
<tr>
<td>-n string</td>
<td>the lenth of string is greater than zero</td>
</tr>
<tr>
<td>-z string</td>
<td>the lenth of string is zero</td>
</tr>
<tr>
<td>s1 = s2 or s1 == s2</td>
<td>equal</td>
</tr>
<tr>
<td>s1 !=s2</td>
<td>not equal</td>
</tr>
<tr>
<td>s1 &gt; s2</td>
<td>s1 sorts after s2</td>
</tr>
<tr>
<td>s1 &lt; s2</td>
<td>s1 sortf before s2</td>
</tr>
</tbody></table>
<h4 id="Integer-Expressions"><a href="#Integer-Expressions" class="headerlink" title="Integer Expressions"></a>Integer Expressions</h4><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>int1 -eq int2</td>
<td>equal</td>
</tr>
<tr>
<td>int1 -ne int2</td>
<td>not equal</td>
</tr>
<tr>
<td>-le</td>
<td>less or equal</td>
</tr>
<tr>
<td>-lt</td>
<td>less than</td>
</tr>
<tr>
<td>-ge</td>
<td>greater or equal</td>
</tr>
<tr>
<td>-gt</td>
<td>greater</td>
</tr>
</tbody></table>
<h4 id="A-More-Modern-Version-of-test"><a href="#A-More-Modern-Version-of-test" class="headerlink" title="A More Modern Version of test"></a>A More Modern Version of test</h4><ul>
<li><strong>Designed of string</strong><ul>
<li><code>[[ command ]]</code></li>
</ul>
</li>
</ul>
<p>and here is a new feature:<br><code>string1 =~ regex</code>. This return true if string1 matched by the extended regular expression</p>
<ul>
<li><strong>Designed of Integer</strong><ul>
<li>`(( command ))</li>
<li>integer only</li>
</ul>
</li>
</ul>
<h3 id="case"><a href="#case" class="headerlink" title="case"></a>case</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> word <span class="keyword">in</span></span><br><span class="line">    [pattern [| pattern]...) commands ;;]...</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$num</span> <span class="keyword">in</span></span><br><span class="line">    0) <span class="built_in">echo</span> <span class="string">"zero"</span></span><br><span class="line">        ;;  <span class="comment"># ;; break and out of case</span></span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<h4 id="pattern"><a href="#pattern" class="headerlink" title="pattern"></a>pattern</h4><table>
<thead>
<tr>
<th>pattern</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>a)</td>
<td>matches if word equals a</td>
</tr>
<tr>
<td>[[:alpha:]]</td>
<td>matches if word is a single alphabetic</td>
</tr>
<tr>
<td>???)</td>
<td>matches if word is exactly three characters long</td>
</tr>
<tr>
<td>*.txt</td>
<td>matches if word ends with .txt</td>
</tr>
<tr>
<td>*)</td>
<td>matches any value.</td>
</tr>
</tbody></table>
<h3 id="for-while-until"><a href="#for-while-until" class="headerlink" title="for/while/until"></a>for/while/until</h3><ul>
<li>for <ul>
<li><code>for variable in words; do commands done</code></li>
<li><code>for (( expression1; expression2; expression3 )); do commands done</code></li>
</ul>
</li>
<li>while <ul>
<li><code>while commands; do commands; done</code></li>
<li>while commands is true continue</li>
</ul>
</li>
<li>until <ul>
<li><code>until commands; do commands; done</code></li>
<li>while commands is false continue</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/23/universe/regular_expression/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/23/universe/regular_expression/" class="post-title-link" itemprop="url">正则表达式基础语法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-23 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-23T00:00:00+08:00">2020-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-24 16:58:42" itemprop="dateModified" datetime="2020-08-24T16:58:42+08:00">2020-08-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Base/Extended Regex</p>
<ul>
<li><code>.</code><ul>
<li>匹配任何一个字符</li>
</ul>
</li>
<li><code>*</code><ul>
<li>匹配任何数量(包括0)的前面的内容，贪婪匹配</li>
</ul>
</li>
<li><code>+</code><ul>
<li>匹配任何数量(不包括0)的前面的内容，非贪婪匹配</li>
</ul>
</li>
<li><code>{1}</code><ul>
<li>重复次数1</li>
</ul>
</li>
<li><code>\S</code><ul>
<li>任何非空白字符</li>
</ul>
</li>
<li><code>\s</code><ul>
<li>任何空白字符</li>
</ul>
</li>
<li><code>?</code><ul>
<li>前面内容是可选的</li>
</ul>
</li>
<li><code>\</code><ul>
<li>有时可以起到转意的作用，<code>\S</code>等就是例外</li>
</ul>
</li>
<li><code>[0-9]</code><ul>
<li>任何0到9的数字，范围可变但要按顺序</li>
</ul>
</li>
<li><code>[a-z]</code><ul>
<li>任何a到z的小写字符，范围可变但要按顺序</li>
</ul>
</li>
<li><code>[A-Z]</code><ul>
<li>任何A到Z的大写字符，范围可变但要按顺序</li>
</ul>
</li>
<li><code>[A-Za-z]</code><ul>
<li>任何A到Z的字符，范围可变但要按顺序</li>
</ul>
</li>
<li>锚定<ul>
<li><code>$</code><ul>
<li>以前面的内容结束</li>
</ul>
</li>
<li><code>^</code><ul>
<li>以前面的内容开头</li>
</ul>
</li>
<li><code>\&lt; ,\b</code><ul>
<li>锚定单词首部</li>
</ul>
</li>
<li><code>\&gt; ,\b</code><ul>
<li>锚定单词结尾</li>
</ul>
</li>
</ul>
</li>
<li><code>|</code><ul>
<li>or，整个左边或整个右边如<code>C|cat</code>表示C或cat</li>
<li>也可使用分组改变执行顺序<code>(C|c)at</code>表示Cat或cat</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/20/universe/linux/linux_note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/20/universe/linux/linux_note/" class="post-title-link" itemprop="url">Linux学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-20 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-20T00:00:00+08:00">2020-01-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-12 11:47:28" itemprop="dateModified" datetime="2020-09-12T11:47:28+08:00">2020-09-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Linux哲学"><a href="#Linux哲学" class="headerlink" title="Linux哲学"></a>Linux哲学</h2><ul>
<li>Linux基本原则<ul>
<li><ol>
<li>由目的单一的小程序组成，组合小程序完整复杂任务</li>
</ol>
</li>
<li><ol start="2">
<li>一切皆文件</li>
</ol>
</li>
<li><ol start="3">
<li>避免捕获用户接口，避免与用户交互</li>
</ol>
</li>
<li><ol start="4">
<li>配置文件保存为纯文本格式</li>
</ol>
</li>
</ul>
</li>
<li>命令格式<code>命令 选项 参数</code><ul>
<li>短选项：<code>-</code>加某个字母，如<code>-h</code>查看help<ul>
<li>短选项可以多个选项写一起<code>-a -b = -ab</code></li>
</ul>
</li>
<li>长选项：<code>--&lt;option&gt;</code></li>
</ul>
</li>
<li>命令模板<ul>
<li><code>[]</code>中表示可选的内容</li>
<li><code>&lt;&gt;</code>中表示必须给出的内容</li>
<li><code>...</code>表示可以出现多个，可以使用多次</li>
<li>用<code>|</code>分割表示多选一，如<code>[-a|-b]</code></li>
</ul>
</li>
<li>魔数Magic Number：标记文件的执行格式，如<code>#!/bin/sh</code>，也称为shebang</li>
</ul>
<h3 id="FHS-文件层级系统"><a href="#FHS-文件层级系统" class="headerlink" title="FHS(文件层级系统)"></a>FHS(文件层级系统)</h3><ul>
<li>/boot: 系统启动相关文件</li>
<li>/dev: 设备文件</li>
<li>/etc: 配置文件，存文本</li>
<li>/home: 用户家目录</li>
<li>/root: 管理员家目录</li>
<li>/lib: 库文件<ul>
<li>/lib/modules: 内核模块文件</li>
<li>静态库<ul>
<li>linux下表现为.a</li>
</ul>
</li>
<li>动态库:载入到内存中可以复用<ul>
<li>win下表现为.dll文件，linux下表现为.so(shared object)</li>
</ul>
</li>
</ul>
</li>
<li>/opt: 可选目录，第三方程序的安装目录</li>
<li>/proc: 伪文件系统，内核映射</li>
<li>/sys: 伪文件系统，跟硬件相关的属性映射</li>
<li>/tmp: 临时文件，会定时清理</li>
<li>/var: 可变化文件</li>
<li>/bin: 可执行文件，用户命令</li>
<li>/sbin: 管理命令</li>
<li>/usr: universal shared read-only<ul>
<li>usr下之所以有/usr/bin和/usr/sbin是因为/bin跟启动系统相关，而/usr下跟启动系统后提供正常功能相关</li>
</ul>
</li>
<li>/usr/local: 又是一个独立的文件系统，也有bin，sbin。是第三方软件的安装路径</li>
</ul>
<h2 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h2><ul>
<li>man：查看手册<ul>
<li><code>whatis name</code>查看name的目录，使用<code>man [n] name</code>打开name第n章</li>
</ul>
</li>
<li>tr：字符串转换或删除<ul>
<li><code>tr &#39;a-z&#39; &#39;A-Z&#39;</code>把输入中的字符转换成大写</li>
<li><code>tr -d &#39;abc&#39;</code>删除出现的字符，这里是a，b，c</li>
</ul>
</li>
<li>shell中可以开子shell，使用<code>pstree</code>可以查看父子关系，使用exit退出一个</li>
<li>环境变量<ul>
<li><code>PATH</code>命令搜索路径</li>
<li><code>HISTSIZE</code>命令历史缓冲区<ul>
<li>使用<code>history</code>查看命令历史</li>
<li>使用<code>!n</code>执行命令历史中第n条历史命令</li>
<li>使用<code>!-n</code>执行命令历史中倒数第n条历史命令</li>
<li>使用<code>!!</code>执行刚才执行的命令</li>
<li>使用<code>!string</code>执行命令历史中最近的以指定字符串开头的命令</li>
<li>使用<code>!$</code>引用上一个命令的最后一个参数</li>
</ul>
</li>
</ul>
</li>
<li>命令替换：<code>$(COMMAND)</code>或使用反引号`COMMAND`<ul>
<li>把命令的结果放入一个命令中</li>
<li><code>echo $(ls)</code></li>
</ul>
</li>
<li><strong>shell中的引号</strong>：<ul>
<li>反引号``：命令替换</li>
<li>双引号””：弱引用。可以实现变量替换</li>
<li>单引号’’：强引用。不能实现变量替换</li>
</ul>
</li>
<li>文件名通配，globbing<ul>
<li><code>*</code>：任意长度的任意字符</li>
<li><code>?</code>：任意单个字符</li>
<li><code>[]</code>：指定范围内的任意单个字符</li>
<li><code>[^]</code>：指定范围外的任意单个字符</li>
<li>特殊字符，形如<code>[:punct:]</code>。<code>[:punct:]</code>所有的标点符号</li>
</ul>
</li>
<li>生成列表<ul>
<li><code>seq [OPTION] [FIRST] [INCREMENT] LAST</code></li>
</ul>
</li>
<li><code>xargs</code><ul>
<li>从标准输入接收命令并执行</li>
</ul>
</li>
<li><code>w</code><ul>
<li>显示已登录的用户</li>
</ul>
</li>
<li><code>last</code><ul>
<li>显示登录日志，即显示<code>/var/log/wtmp</code>文件</li>
</ul>
</li>
<li><code>lastb</code><ul>
<li>显示错误的登录日志，即显示<code>/var/log/btmp</code>文件</li>
</ul>
</li>
<li><code>lastlog</code><ul>
<li>显示每一个用户最近一次的成功登录信息</li>
</ul>
</li>
<li><code>basename</code><ul>
<li>显示文件的基路径名</li>
</ul>
</li>
</ul>
<h2 id="管道及IO重定向"><a href="#管道及IO重定向" class="headerlink" title="管道及IO重定向"></a>管道及IO重定向</h2><ul>
<li>系统设定<ul>
<li>默认输入设备，标准输入，stdin, 0</li>
<li>默认输出设备，标准输出，stdout, 1</li>
<li>标准错误输出，stderr, 2</li>
</ul>
</li>
<li>重定向，默认都是重定向标准输入输出<ul>
<li>输出重定向<ul>
<li><code>&gt;</code>覆盖输出<ul>
<li>强制覆盖：当设置了不允许覆盖已存在文件时使用<code>&gt;|</code></li>
</ul>
</li>
<li><code>&gt;&gt;</code>追加输出</li>
<li><code>2&gt;</code>, <code>2&gt;&gt;</code>重定向错误输出<ul>
<li>可以使用<code>ls ./ &gt; a.out 2&gt; b.out</code>这样的形式</li>
</ul>
</li>
<li><code>&amp;&gt;</code>重定向标准输出或错误输出到同一个文件</li>
</ul>
</li>
<li>输入重定向<ul>
<li><code>&lt;</code>输入重定向</li>
<li><code>&lt;&lt;</code>Here Document  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &lt;&lt; END_SIGN</span><br><span class="line">&gt; hello</span><br><span class="line">&gt; END_SIGN</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>管道<ul>
<li><code>cmd1 | cmd2</code>前一个命令的输出作为后一个命令的输入</li>
</ul>
</li>
<li>tee<ul>
<li><code>man tee</code>一个输入两个输出</li>
</ul>
</li>
</ul>
<h2 id="Shell编程"><a href="#Shell编程" class="headerlink" title="Shell编程"></a>Shell编程</h2><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p><code>VARNAME=VALUE</code></p>
<ul>
<li>引用：<code>$VAENAME</code> or <code>${VARNAME}</code>，注意<code>$()</code>是引用执行结果，而<code>{}</code>才是引用内容</li>
<li>环境变量：作用域为当前shell或器子进程<ul>
<li>用<code>export</code>导出，<code>export var=value</code></li>
</ul>
</li>
<li>位置变量<ul>
<li><code>$0, $1, ...</code>，所有参数，第一个参数…</li>
<li><code>shift [n]</code>，把第一个变量弹出。因此有很多变量时可以使用shift</li>
</ul>
</li>
<li>特殊变量<ul>
<li><code>$?</code>，上一个命令的<strong>执行状态</strong>返回值，0正确，1~255执行错误</li>
<li><code>$#</code>，参数个数</li>
<li><code>$*</code>，参数列表</li>
<li><code>$@</code>，参数列表</li>
</ul>
</li>
<li>声明<code>declare [OPTION] VAR=VALUE</code><ul>
<li><code>declare -i SUM=0</code>，声明整形变量SUM</li>
<li><code>declare -x A=0</code>，声明export变量A</li>
</ul>
</li>
</ul>
<h3 id="条件分支"><a href="#条件分支" class="headerlink" title="条件分支"></a>条件分支</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if expression; then</span><br><span class="line">    statement</span><br><span class="line">elif</span><br><span class="line">    statement</span><br><span class="line">else</span><br><span class="line">    statement</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<ul>
<li>条件测试的表达式<ul>
<li><code>[ expression ]</code>， <strong>注意</strong> 中扩号两端的空格是必须的</li>
<li><code>[[ expression ]]</code>，两种方法用法相同，但是两个中括号是bash的关键字</li>
<li><code>test expression</code></li>
<li>因为if语句取的是表达式执行状态的结果，所以如果条件判断是命令则不需要中括号，如<code>if test expression; then</code></li>
</ul>
</li>
<li>shell中进行算数运算<ul>
<li><strong>shell把所有的变量都当作字符</strong>，所以要进行算数运算需要额外操作</li>
<li><ol>
<li><code>let</code>，见<code>help let</code>。如<code>let c=$a+$b</code></li>
</ol>
</li>
<li><ol start="2">
<li><code>$[expression]</code>。如<code>c=$[$a+$b]</code></li>
</ol>
</li>
<li><ol start="3">
<li><code>$(())</code>。如<code>c=$(($a+$b))</code></li>
</ol>
</li>
<li><ol start="4">
<li><code>expr expression</code>，表达式中，各操作数和操作符直接要有空格，且要使用命令引用。因为本质是调用<code>expr</code>程序。如<code>c=$(expr $a + $b)</code></li>
</ol>
</li>
</ul>
</li>
<li>退出脚本：<code>exit</code><ul>
<li>如果没有指定退出状态，则返回上一条命令的执行状态</li>
<li>0正确，1～255错误</li>
</ul>
</li>
<li>文件测试<ul>
<li><code>-e FILE</code>，是否存在</li>
<li><code>-f FILE</code>，是否普通文件</li>
<li><code>-d FILE</code>，是否为目录</li>
<li><code>-r/w/x</code>，是否可读写执行</li>
</ul>
</li>
<li>组合测试条件<ul>
<li><code>-a</code>，逻辑与</li>
<li><code>-o</code>，逻辑或</li>
<li><code>!</code>，非</li>
<li>也可以使用<code>[ expression ] || [ expression ]</code></li>
</ul>
</li>
</ul>
<h4 id="switch-case"><a href="#switch-case" class="headerlink" title="switch case"></a>switch case</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> SWITCH <span class="keyword">in</span></span><br><span class="line">    value1)</span><br><span class="line">        statement</span><br><span class="line">        ...</span><br><span class="line">        ;;</span><br><span class="line">    value2|value3)</span><br><span class="line">        statement</span><br><span class="line">        ...</span><br><span class="line">        ;;</span><br><span class="line">    [0-9])</span><br><span class="line">        statement</span><br><span class="line">        ...</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        statement</span><br><span class="line">        ...</span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>


<h3 id="文本处理"><a href="#文本处理" class="headerlink" title="文本处理"></a>文本处理</h3><h4 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h4><p>流编辑器(Stream EDitor, sed)。行编辑器。默认将输出到屏幕</p>
<p><code>sed [option] &#39;AddressCommand&#39; file...</code></p>
<ul>
<li>option<ul>
<li><code>-n</code>静默模式，不再显示模式空间中的内容</li>
<li><code>-i</code>修改原文件</li>
<li><code>-r</code>使用扩展正则表达式</li>
</ul>
</li>
<li>Address:<ul>
<li><ol>
<li>Startline,Endline<ul>
<li>$ 表示最后一行</li>
</ul>
</li>
</ol>
</li>
<li><ol start="2">
<li>/RegExp/</li>
</ol>
</li>
<li><ol start="3">
<li>/pattern1/,/pattern2/<ul>
<li>从被1匹配到的行开始到被2匹配的行结束</li>
</ul>
</li>
</ol>
</li>
<li><ol start="4">
<li>Startline, +N<ul>
<li>从起始行开始向后N行</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li>Command<ul>
<li><code>d</code>删除<ul>
<li>如<code>sed 1,2d</code></li>
</ul>
</li>
<li><code>p</code>显示符合条件行</li>
<li><code>a string</code>在指定行后追加</li>
<li><code>i string</code>在指定行前面加</li>
<li><code>r FILE</code>将指定文件的内容添加都符号条件的行</li>
<li><code>w FILE</code>将地址指定的范围的行保存到指定文件中</li>
<li><code>s/pattern/string/[opt]</code>查找并替换<ul>
<li><code>g</code>全局替换</li>
<li><code>i</code>忽略大小写</li>
<li>分隔符号不一定是<code>/</code>也可是<code>@, #, ~...</code>等</li>
<li><code>%</code>全文查找</li>
</ul>
</li>
<li>引用匹配串<ul>
<li><code>&amp;</code>整个串</li>
<li><code>\1</code>第1组</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="特殊权限"><a href="#特殊权限" class="headerlink" title="特殊权限"></a>特殊权限</h3><ul>
<li><p>SUID：文件运行时，相应进程的属主是程序文件自身的属主，而非启动者</p>
<ul>
<li><code>chmod u+s FILE</code></li>
<li><code>chmod u-s FILE</code></li>
<li>如果FILE本身就有执行权限，则SUID显示为s，否则为S</li>
</ul>
</li>
<li><p>GUID：文件运行时，相应进程的属组是程序文件自身的属组，而非启动者所属的基本组</p>
<ul>
<li><code>chmod g+s FILE</code></li>
<li><code>chmod g-s FILE</code></li>
</ul>
</li>
<li><p>Sticky：在一个公共目录，每个用户都可以创建文件，删除自己的文件，但不能删除别人的文件</p>
<ul>
<li><code>chmod o+t DIR</code></li>
<li><code>chmod o-t DIR</code></li>
</ul>
</li>
<li><p>也可用<code>111</code>，二进制表示</p>
</li>
<li><p>FACL, Filesystem Access Control List</p>
<ul>
<li><code>setfacl OPTION FILE</code><ul>
<li><code>-m</code>，设定<ul>
<li><code>u:UID:perm</code></li>
<li><code>g:GID:perm</code></li>
</ul>
</li>
<li><code>-x</code>，取消设定</li>
</ul>
</li>
<li><code>getfacl FILE</code></li>
</ul>
</li>
</ul>
<h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><h3 id="创建设备节点"><a href="#创建设备节点" class="headerlink" title="创建设备节点"></a>创建设备节点</h3><p><code>mknod</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">                         主设备号  次设备号             </span><br><span class="line">crw-rw----+ 1 root video      81,   2   Aug 31 17:04 video2</span><br></pre></td></tr></table></figure>


<h3 id="文件系统-1"><a href="#文件系统-1" class="headerlink" title="文件系统"></a>文件系统</h3><p>文件系统类型众多，接口可能各异，软件开发不可能要为每种文件系统的不同接口编写代码，那就本末倒置了。所以 <strong>Linux使用VFS(虚拟文件系统)作为翻译官</strong> 以支持众多文件系统。</p>
<p>linux常用的文件系统有ext3、ext4、xfs…</p>
<p>创建文件系统：<code>mkfs</code></p>
<ul>
<li>格式化<ul>
<li>高级格式化：创建文件系统<code>mkfs</code></li>
</ul>
</li>
</ul>
<h3 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h3><p>linux使用线性虚拟内存做中介，从虚拟内存映射到物理内存。当物理内存满时，将闲置的程序内存放到交换空间。</p>
<p>查看内存以及交换空间<code>free</code>，默认单位是字节，<code>free -m</code>以兆为单位显示。</p>
<ul>
<li>交换空间扩容<ul>
<li><ol>
<li>新建分区</li>
</ol>
</li>
<li><ol start="2">
<li>创建交换分区文件系统<code>mkswap /path/dev</code></li>
</ol>
</li>
<li><ol start="3">
<li>启用交换空间<code>swapon /path/dev</code>，关闭交换分区<code>swapoff /path/dev</code></li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="dd命令"><a href="#dd命令" class="headerlink" title="dd命令"></a>dd命令</h3><p><code>man dd</code> conver and copy a file，转换并复制文件。取别于cp，cp是以文件为单位复制，而dd复制的是底层是数据流。cp复制文件需要将文件从文件系统读取到内存，然后再从内存复制到文件系统的其他位置。而dd复制相当于直接复制文件的二进制代码。</p>
<p>dd的好处是可以只复制文件的某一部分。</p>
<ul>
<li><code>dd if=&lt;src&gt; of=&lt;tar&gt;</code><ul>
<li>dd备份<ul>
<li><code>dd if=/dev/sda of=/mnt/usb/mdr.bak bs=512 count=1</code></li>
<li><code>dd if=/mnt/usb/mdr.bak of=/dev/sda bs=512 count=1</code></li>
<li>每次复制512byte，共复制1次</li>
</ul>
</li>
<li>用dd做磁盘镜像<ul>
<li><code>dd if=/path/dev of=/path/xxx.iso bs=1M count=1024</code></li>
<li>还可以用来做磁盘性能测试</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="fstab文件"><a href="#fstab文件" class="headerlink" title="fstab文件"></a>fstab文件</h3><p>文件系统配置文件<code>/etc/fstab</code>文件系统表。初始化时会自动挂载此文件中定义的每个文件系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">要挂载的设备 挂载点 文件系统类型 挂载选项 转储频率 文件系统检测次序</span><br><span class="line">    转储频率 表示多长时间(天)做次备份</span><br><span class="line">    文件系统检测次序 只有根可以为1</span><br></pre></td></tr></table></figure>


<h3 id="mount命令"><a href="#mount命令" class="headerlink" title="mount命令"></a>mount命令</h3><ul>
<li><code>mount DEVICE MOUNT_POINT</code><ul>
<li><code>-o loop</code>挂载本地回环设备。<strong>如iso镜像</strong></li>
<li><code>-a</code>挂载定义在fstab中的所有文件系统 </li>
</ul>
</li>
</ul>
<p>当<code>umount</code>busy时，可以使用<code>fuser -v /mount/point</code>查看谁在访问。使用<code>fuser -km /mount/point</code>杀死所有进程</p>
<h3 id="文件压缩与归档"><a href="#文件压缩与归档" class="headerlink" title="文件压缩与归档"></a>文件压缩与归档</h3><p>对于文本文件，会发现压缩比非常打，这是因为对文本文件的压缩，是对文本进行标记，以后该文本再次出现时，使用标记代替文本，以达到压缩的目的。算法不同压缩比也可能不同。</p>
<ul>
<li>目流行的压缩格式(工具):xz(zx), bz2(bzip2), gz(gzip)。只能压缩文件，不能压缩目录。默认还会删除原文件。<ul>
<li>gzip<ul>
<li>压缩<code>gzip &lt;FILE&gt;</code><ul>
<li><code>-[1-9]</code>指定压缩比</li>
</ul>
</li>
<li>解压缩<code>gunzip &lt;FILE&gt;</code>或<code>gzip -d &lt;FILE&gt;</code></li>
<li><code>zcat</code>在不解压的情况下查看文本文件的内容</li>
</ul>
</li>
<li>bz2<ul>
<li><code>bzip2</code>压缩，对于大文件比gzip有更大压缩比的工具，格式近似</li>
<li><code>-d</code>解压缩</li>
<li><code>-k</code>压缩保留源文件</li>
<li><code>bunzip2</code>解压</li>
<li><code>bzcat</code></li>
</ul>
</li>
<li>xz<ul>
<li>格式类似<code>man xz</code></li>
</ul>
</li>
<li>zip<ul>
<li><strong>压缩比不大</strong>，但可以压缩目录，格式也独特</li>
<li><code>zip OUT_FILE.ZIP IN_FILE1 ...</code></li>
<li>这种能将多个文件整合在一起就叫<strong>archive(归档)</strong></li>
</ul>
</li>
</ul>
</li>
<li>归档工具，只归档不压缩，体积还会变大<ul>
<li>tar<ul>
<li><code>-c</code>创建归档文件</li>
<li><code>-f</code>FILE` <strong>操作的文件</strong></li>
<li><code>-x</code>展开归档, 一般用<code>-xf</code></li>
<li><code>--xattrs</code>归档时保留其扩展属性信息</li>
<li><code>-t</code>查看归档里有啥</li>
</ul>
</li>
</ul>
</li>
<li>即归档又压缩<ul>
<li>当然可以先使用tar归档，再压缩。但是可以直接一步到位<ul>
<li><code>-zcf</code>归档然后调用gzip压缩</li>
<li><code>-zxf</code>调用gzip解压缩然后展开归档</li>
<li><code>-jcf</code>, <code>-jxf</code>调用bz2</li>
<li><code>-Jcf</code>, <code>-Jxf</code>调用xz</li>
<li>展开时使用的工具可以省略，如<code>-xf</code></li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">57</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">52</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
